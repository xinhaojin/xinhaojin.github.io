<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-centos7使用docker部署chatgpt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/03/centos7%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2chatgpt/" class="article-date">
  <time class="dt-published" datetime="2023-04-03T06:36:00.000Z" itemprop="datePublished">2023-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/03/centos7%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2chatgpt/">centos7使用docker部署chatgpt</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>

<h3 id="查看安装版本"><a href="#查看安装版本" class="headerlink" title="查看安装版本"></a>查看安装版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<h3 id="卸载docker"><a href="#卸载docker" class="headerlink" title="卸载docker"></a>卸载docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">sudo yum remove docker #删除早期版本</span><br><span class="line">sudo rm -rf /var/lib/docker #删除Docker数据目录</span><br></pre></td></tr></table></figure>

<h3 id="使用docker"><a href="#使用docker" class="headerlink" title="使用docker"></a>使用docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker #启动docker服务</span><br><span class="line">systemctl stop docker #关闭docker服务</span><br><span class="line">sudo systemctl enable docker #开机启动</span><br><span class="line">docker ps -a #查看所有容器</span><br><span class="line">docker stop myname #停止容器名为&#x27;myname&#x27;的容器</span><br></pre></td></tr></table></figure>

<h2 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h2><p>发布地址 <a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="授予执行权限"><a href="#授予执行权限" class="headerlink" title="授予执行权限"></a>授予执行权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="创建软连接"><a href="#创建软连接" class="headerlink" title="创建软连接"></a>创建软连接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="查看安装版本-1"><a href="#查看安装版本-1" class="headerlink" title="查看安装版本"></a>查看安装版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="部署chatgpt项目"><a href="#部署chatgpt项目" class="headerlink" title="部署chatgpt项目"></a>部署chatgpt项目</h2><p><a target="_blank" rel="noopener" href="https://github.com/Chanzhaoyu/chatgpt-web">https://github.com/Chanzhaoyu/chatgpt-web</a></p>
<h3 id="新建文件夹"><a href="#新建文件夹" class="headerlink" title="新建文件夹"></a>新建文件夹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir chatgpt</span><br><span class="line">cd chatgpt</span><br></pre></td></tr></table></figure>

<h3 id="新建docker-compose-yml"><a href="#新建docker-compose-yml" class="headerlink" title="新建docker-compose.yml"></a>新建docker-compose.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">chenzhaoyu94/chatgpt-web</span> <span class="comment"># 总是使用 latest ,更新时重新 pull 该 tag 镜像即可</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3002</span><span class="string">:3002</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 二选一</span></span><br><span class="line">      <span class="comment">#OPENAI_API_KEY: XXXXXX</span></span><br><span class="line">      <span class="attr">OPENAI_ACCESS_TOKEN:</span> <span class="string">XXXXXXX</span></span><br><span class="line">      <span class="attr">API_REVERSE_PROXY:</span> <span class="string">https://bypass.churchless.tech/api/conversation</span></span><br><span class="line">      <span class="comment"># 超时，单位毫秒，可选</span></span><br><span class="line">      <span class="attr">TIMEOUT_MS:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure>

<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">API</span> <span class="string">可用：</span></span><br><span class="line"></span><br><span class="line"><span class="string">OPENAI_API_KEY</span> <span class="string">和</span> <span class="string">OPENAI_ACCESS_TOKEN</span> <span class="string">二选一</span></span><br><span class="line"><span class="string">OPENAI_API_MODEL</span> <span class="string">设置模型，可选，默认：gpt-3.5-turbo</span></span><br><span class="line"><span class="string">OPENAI_API_BASE_URL</span> <span class="string">设置接口地址，可选，默认：https://api.openai.com</span></span><br><span class="line"><span class="string">OPENAI_API_DISABLE_DEBUG</span> <span class="string">设置接口关闭</span> <span class="string">debug</span> <span class="string">日志，可选，默认：empty</span> <span class="string">不关闭</span></span><br><span class="line"></span><br><span class="line"><span class="string">ACCESS_TOKEN</span> <span class="string">可用：</span></span><br><span class="line"></span><br><span class="line"><span class="string">OPENAI_ACCESS_TOKEN</span> <span class="string">和</span> <span class="string">OPENAI_API_KEY</span> <span class="string">二选一，同时存在时，OPENAI_API_KEY</span> <span class="string">优先</span></span><br><span class="line"><span class="string">API_REVERSE_PROXY</span> <span class="string">设置反向代理，可选</span> <span class="string">https://bypass.churchless.tech/api/conversation</span> <span class="string">或</span> <span class="string">https://api.pawan.krd/backend-api/conversation</span></span><br><span class="line"><span class="string">通用：</span></span><br><span class="line"></span><br><span class="line"><span class="string">AUTH_SECRET_KEY</span> <span class="string">访问权限密钥，可选</span></span><br><span class="line"><span class="string">MAX_REQUEST_PER_HOUR</span> <span class="string">每小时最大请求次数，可选，默认无限</span></span><br><span class="line"><span class="string">TIMEOUT_MS</span> <span class="string">超时，单位毫秒，可选</span></span><br><span class="line"><span class="string">SOCKS_PROXY_HOST</span> <span class="string">和</span> <span class="string">SOCKS_PROXY_PORT</span> <span class="string">一起时生效，可选</span></span><br><span class="line"><span class="string">SOCKS_PROXY_PORT</span> <span class="string">和</span> <span class="string">SOCKS_PROXY_HOST</span> <span class="string">一起时生效，可选</span></span><br><span class="line"><span class="string">HTTPS_PROXY</span> <span class="string">支持</span> <span class="string">http，https,</span> <span class="string">socks5，可选</span></span><br><span class="line"><span class="string">ALL_PROXY</span> <span class="string">支持</span> <span class="string">http，https,</span> <span class="string">socks5，可选</span></span><br></pre></td></tr></table></figure>

<p>OPENAI_API_KEY获取地址 <a target="_blank" rel="noopener" href="https://platform.openai.com/overview">https://platform.openai.com/overview</a><br><code>&lt;br&gt;</code>ACCESS_TOKEN获取地址 <a target="_blank" rel="noopener" href="https://chat.openai.com/api/auth/session">https://chat.openai.com/api/auth/session</a><br><code>&lt;br&gt;</code>免费账户选择ACCESS_TOKEN设置反向代理即可</p>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>在新建的目录下执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>默认容器名为chatgpt-web-app-1</p>
<h3 id="放行端口"><a href="#放行端口" class="headerlink" title="放行端口"></a>放行端口</h3><p>检查系统是否安装了firewalld</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status firewalld</span><br></pre></td></tr></table></figure>

<p>如果该命令返回firewalld服务的状态，则说明firewalld已经安装。如果没有安装，请使用以下命令安装firewalld</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y firewalld</span><br></pre></td></tr></table></figure>

<p>打开需要放行的端口（例如3002）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=public --add-port=3002/tcp --permanent</span><br></pre></td></tr></table></figure>

<p>重新加载防火墙规则，以便它们在系统重启后仍然生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>云服务器额外在控制台放行端口</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/03/centos7%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2chatgpt/" data-id="cm9zmq8xd002gsqhl1wzxee9u" data-title="centos7使用docker部署chatgpt" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chatgpt/" rel="tag">chatgpt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-解决录制音视频不同步问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/23/%E8%A7%A3%E5%86%B3%E5%BD%95%E5%88%B6%E9%9F%B3%E8%A7%86%E9%A2%91%E4%B8%8D%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2023-03-23T09:50:00.000Z" itemprop="datePublished">2023-03-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/23/%E8%A7%A3%E5%86%B3%E5%BD%95%E5%88%B6%E9%9F%B3%E8%A7%86%E9%A2%91%E4%B8%8D%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/">解决录制音视频不同步问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>使用opencv录制视频，同时使用pyaudio录制音频，存在两个问题<code>&lt;br&gt;</code><br>1.视频录制和音频录制没有同时启动，开始时间对不上<code>&lt;br&gt;</code><br>2.视频录制时长和视频保存后的时长不一致，会出现视频变慢的现象</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>1.使用event事件，使两个录制同步开始<code>&lt;br&gt;</code><br>2.读取音频视频时长，调整视频帧率，把视频时长调整成和音频一样长，再把音频合并到视频中。</p>
<h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> pyaudio</span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> *</span><br><span class="line">  </span><br><span class="line"><span class="comment">#全局变量，控制录制停止</span></span><br><span class="line">allowRecord=<span class="literal">False</span></span><br><span class="line">cap=<span class="literal">None</span></span><br><span class="line"><span class="comment">#录像</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">record_video</span>(<span class="params">event</span>):</span><br><span class="line">    <span class="keyword">global</span> cap</span><br><span class="line">    cap=cv2.VideoCapture(<span class="number">0</span>+ cv2.CAP_DSHOW)</span><br><span class="line">    writer=cv2.VideoWriter(<span class="string">&#x27;output.mp4&#x27;</span>,cv2.VideoWriter_fourcc(*<span class="string">&#x27;MJPG&#x27;</span>),<span class="number">25</span>,(<span class="number">640</span>,<span class="number">480</span>))</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">global</span> allowRecord</span><br><span class="line">    allowRecord=<span class="literal">True</span><span class="comment">#录制启动</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;录像开始时间：&#x27;</span>+datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S.%f&#x27;</span>))</span><br><span class="line">    <span class="keyword">while</span> allowRecord==<span class="literal">True</span>:</span><br><span class="line">        ret,frame=cap.read()</span><br><span class="line">        <span class="keyword">if</span> ret:</span><br><span class="line">            writer.write(frame)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;录像结束时间：&#x27;</span>+datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S.%f&#x27;</span>))</span><br><span class="line">    allowRecord=<span class="literal">False</span></span><br><span class="line">    cap.release()</span><br><span class="line">  </span><br><span class="line"><span class="comment">#录音</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">record_audio</span>(<span class="params">event</span>):</span><br><span class="line">    <span class="keyword">global</span> allowRecord</span><br><span class="line">    <span class="comment">#等待event启动录制音频</span></span><br><span class="line">    p=pyaudio.PyAudio()</span><br><span class="line">    <span class="keyword">global</span> stream</span><br><span class="line">    stream=p.<span class="built_in">open</span>(<span class="built_in">format</span>=pyaudio.paInt16,channels=<span class="number">1</span>,rate=<span class="number">16000</span>,<span class="built_in">input</span>=<span class="literal">True</span>,frames_per_buffer=<span class="number">1024</span>)</span><br><span class="line">    wf = wave.<span class="built_in">open</span>(<span class="string">&#x27;output.wav&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    wf.setnchannels(<span class="number">1</span>)</span><br><span class="line">    wf.setsampwidth(p.get_sample_size(pyaudio.paInt16))</span><br><span class="line">    wf.setframerate(<span class="number">16000</span>)</span><br><span class="line">    event.wait()</span><br><span class="line">    <span class="comment">#输出时间戳,精确到毫秒</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;录音开始时间：&#x27;</span>+datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S.%f&#x27;</span>))</span><br><span class="line">    <span class="keyword">while</span> allowRecord==<span class="literal">True</span>:</span><br><span class="line">        data=stream.read(<span class="number">1024</span>)</span><br><span class="line">        wf.writeframes(data)</span><br><span class="line">    wf.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;录音结束时间：&#x27;</span>+datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S.%f&#x27;</span>))</span><br><span class="line">    stream.stop_stream()  <span class="comment"># 关闭流</span></span><br><span class="line">    stream.close()</span><br><span class="line">    p.terminate()</span><br><span class="line">  </span><br><span class="line"><span class="comment">#合并视频音频</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_video_audio</span>(<span class="params">video_path,audio_path</span>):</span><br><span class="line">    audioclip = AudioFileClip(audio_path)</span><br><span class="line">    videoclip = VideoFileClip(video_path)</span><br><span class="line">    videoclip2 = videoclip.set_audio(audioclip)</span><br><span class="line">    video = CompositeVideoClip([videoclip2])</span><br><span class="line">    filename=datetime.now().strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)</span><br><span class="line">    video.write_videofile(filename+<span class="string">&#x27;.mp4&#x27;</span>, codec=<span class="string">&#x27;mpeg4&#x27;</span>, bitrate=<span class="string">&#x27;1000K&#x27;</span>) <span class="comment"># bitrate 设置比特率，比特率越高， 合并的视频越清晰，视频文件也越大</span></span><br><span class="line">    audioclip.close()</span><br><span class="line">    videoclip.close()</span><br><span class="line">    videoclip2.close()</span><br><span class="line">    video.close()</span><br><span class="line">    <span class="comment">#列出所有进程名,关闭所有包含&#x27;ffmpeg&#x27;的进程</span></span><br><span class="line">    process_names=os.popen(<span class="string">&#x27;tasklist&#x27;</span>).readlines()</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> process_names:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ffmpeg&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">            os.system(<span class="string">&#x27;taskkill /f /im &#x27;</span>+name.split()[<span class="number">0</span>])</span><br><span class="line">    os.remove(video_path)</span><br><span class="line">    os.remove(<span class="string">&#x27;output.mp4&#x27;</span>)</span><br><span class="line">    os.rename(audio_path, filename+<span class="string">&#x27;.wav&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;音视频合并成功：&#x27;</span>+filename+<span class="string">&#x27;.mp4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止录制</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stop_record</span>():</span><br><span class="line">    <span class="keyword">global</span> allowRecord</span><br><span class="line">    allowRecord=<span class="literal">False</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">record_video_with_audio</span>():</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    event.clear()</span><br><span class="line">    t1=threading.Thread(target=record_video,args=(event,))</span><br><span class="line">    t2=threading.Thread(target=record_audio,args=(event,))</span><br><span class="line">    <span class="comment">#同步开启录制</span></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    <span class="keyword">while</span> allowRecord==<span class="literal">False</span>:<span class="comment">#等待录制启动</span></span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">    <span class="keyword">while</span> allowRecord:<span class="comment">#等待录制停止</span></span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">#结束线程</span></span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line">    video_path=<span class="string">&#x27;output.mp4&#x27;</span></span><br><span class="line">    audio_path=<span class="string">&#x27;output.wav&#x27;</span></span><br><span class="line">    <span class="comment">#查看时长</span></span><br><span class="line">    video_time=VideoFileClip(video_path).duration</span><br><span class="line">    audio_time=AudioFileClip(audio_path).duration</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;视频时长：&#x27;</span>+<span class="built_in">str</span>(video_time)+<span class="string">&#x27; s&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;音频时长：&#x27;</span>+<span class="built_in">str</span>(audio_time)+<span class="string">&#x27; s&#x27;</span>)</span><br><span class="line">    <span class="comment">#把视频压缩的和音频一样长</span></span><br><span class="line">    <span class="comment"># Load the video</span></span><br><span class="line">    video = cv2.VideoCapture(video_path)</span><br><span class="line">    <span class="comment"># Get the frame rate</span></span><br><span class="line">    fps = video.get(cv2.CAP_PROP_FPS)</span><br><span class="line">    new_fps=video_time/audio_time*fps</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;调整视频帧率为：&#x27;</span>+<span class="built_in">str</span>(new_fps))</span><br><span class="line">    <span class="comment"># Set the frame rate</span></span><br><span class="line">    video.<span class="built_in">set</span>(cv2.CAP_PROP_FPS, new_fps)</span><br><span class="line">    video_writer = cv2.VideoWriter(<span class="string">&#x27;output_new.mp4&#x27;</span>, cv2.VideoWriter_fourcc(*<span class="string">&#x27;MJPG&#x27;</span>), new_fps, (<span class="number">640</span>, <span class="number">480</span>))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># Read the next frame</span></span><br><span class="line">        success, frame = video.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> success:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># Write the frame to the output video</span></span><br><span class="line">        video_writer.write(frame)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Release the video</span></span><br><span class="line">    video.release()</span><br><span class="line">    video_writer.release()</span><br><span class="line">    t=threading.Thread(target=merge_video_audio,args=(<span class="string">&#x27;output_new.mp4&#x27;</span>,<span class="string">&#x27;output.wav&#x27;</span>))</span><br><span class="line">    t.start()</span><br><span class="line">  </span><br><span class="line">t=threading.Thread(target=record_video_with_audio)</span><br><span class="line">t.start()</span><br><span class="line">time.sleep(<span class="number">10</span>)<span class="comment">#录制10s</span></span><br><span class="line">stop_record()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/23/%E8%A7%A3%E5%86%B3%E5%BD%95%E5%88%B6%E9%9F%B3%E8%A7%86%E9%A2%91%E4%B8%8D%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" data-id="cm9zmq90o00i7sqhlgaky1v5r" data-title="解决录制音视频不同步问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9F%B3%E7%94%BB%E5%90%8C%E6%AD%A5/" rel="tag">音画同步</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-人脸关键点检测及人脸分割" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/23/%E4%BA%BA%E8%84%B8%E5%85%B3%E9%94%AE%E7%82%B9%E6%A3%80%E6%B5%8B%E5%8F%8A%E4%BA%BA%E8%84%B8%E5%88%86%E5%89%B2/" class="article-date">
  <time class="dt-published" datetime="2023-03-23T08:41:00.000Z" itemprop="datePublished">2023-03-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/23/%E4%BA%BA%E8%84%B8%E5%85%B3%E9%94%AE%E7%82%B9%E6%A3%80%E6%B5%8B%E5%8F%8A%E4%BA%BA%E8%84%B8%E5%88%86%E5%89%B2/">人脸关键点检测及人脸分割</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>人脸关键点检测，输入opencv格式的bgr通道图，默认在输入图上画关键点，也可以在空白图上画，如果要分割出人脸，可以使用矩形框框住关键点，然后在原图上裁剪，下面是一个成功案例。</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mediapipe <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 输入bgr通道图，输出人脸网点图</span></span><br><span class="line"><span class="comment"># mode=1在原图上画，mode=2在空白图上画</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_face</span>(<span class="params">image,mode=<span class="number">1</span></span>):</span><br><span class="line">    mp_drawing = mp.solutions.drawing_utils</span><br><span class="line">    mp_face_mesh = mp.solutions.face_mesh</span><br><span class="line">    drawing_spec = mp_drawing.DrawingSpec(thickness=<span class="number">1</span>, circle_radius=<span class="number">1</span>, color=(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))<span class="comment">#bgr</span></span><br><span class="line">    <span class="keyword">with</span> mp_face_mesh.FaceMesh(</span><br><span class="line">        max_num_faces=<span class="number">2</span>,</span><br><span class="line">        min_detection_confidence=<span class="number">0.5</span>,</span><br><span class="line">        min_tracking_confidence=<span class="number">0.5</span>) <span class="keyword">as</span> face_mesh:</span><br><span class="line">        image = cv2.cvtColor(cv2.flip(image, <span class="number">1</span>), cv2.COLOR_BGR2RGB)</span><br><span class="line">        <span class="comment"># To improve performance, optionally mark the image as not writeable to</span></span><br><span class="line">        <span class="comment"># pass by reference.</span></span><br><span class="line">        image.flags.writeable = <span class="literal">False</span></span><br><span class="line">        results = face_mesh.process(image)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># Draw the face mesh annotations on the image.</span></span><br><span class="line">        <span class="comment"># and print landmarks&#x27; id, x, y, z </span></span><br><span class="line">        image.flags.writeable = <span class="literal">True</span></span><br><span class="line">        image = cv2.cvtColor(image, cv2.COLOR_RGB2BGR)</span><br><span class="line">        <span class="keyword">if</span> mode==<span class="number">1</span>:</span><br><span class="line">            mask=image</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">elif</span> mode==<span class="number">2</span>:</span><br><span class="line">            <span class="comment">#新建空白图</span></span><br><span class="line">            mask=np.zeros(image.shape,dtype=np.uint8)</span><br><span class="line">        <span class="keyword">if</span> results.multi_face_landmarks:</span><br><span class="line">            <span class="keyword">for</span> face_landmarks <span class="keyword">in</span> results.multi_face_landmarks:</span><br><span class="line">                <span class="comment"># Draw landmarks on the image.</span></span><br><span class="line">                mp_drawing.draw_landmarks(</span><br><span class="line">                    image=mask,<span class="comment">#在空白图上画</span></span><br><span class="line">                    landmark_list=face_landmarks,</span><br><span class="line">                    connections=mp_face_mesh.FACEMESH_CONTOURS,</span><br><span class="line">                    landmark_drawing_spec=drawing_spec,</span><br><span class="line">                    connection_drawing_spec=drawing_spec)</span><br><span class="line">                <span class="comment"># print id, x, y, z</span></span><br><span class="line">                <span class="comment"># time cost </span></span><br><span class="line">                <span class="keyword">if</span> mode==<span class="number">2</span>:</span><br><span class="line">                    xs=[]</span><br><span class="line">                    ys=[]</span><br><span class="line">                    zs=[]</span><br><span class="line">                    <span class="keyword">for</span> <span class="built_in">id</span>,lm <span class="keyword">in</span> <span class="built_in">enumerate</span>(face_landmarks.landmark):</span><br><span class="line">                        ih, iw, ic = image.shape</span><br><span class="line">                        x,y = <span class="built_in">int</span>(lm.x*iw), <span class="built_in">int</span>(lm.y*ih)</span><br><span class="line">                        xs.append(x)</span><br><span class="line">                        ys.append(y)</span><br><span class="line">                        zs.append(lm.z)</span><br><span class="line">                        <span class="comment"># print(id, x,y,lm.z)</span></span><br><span class="line">                    <span class="comment">#用矩形框住这些点</span></span><br><span class="line">                    box=cv2.boundingRect(np.array([xs,ys]).T)</span><br><span class="line">                    <span class="comment">#裁剪原图</span></span><br><span class="line">                    face=mask[box[<span class="number">1</span>]:box[<span class="number">1</span>]+box[<span class="number">3</span>],box[<span class="number">0</span>]:box[<span class="number">0</span>]+box[<span class="number">2</span>]]</span><br><span class="line">                    <span class="comment">#保持比例缩放到128*128</span></span><br><span class="line">                    <span class="keyword">return</span> face</span><br><span class="line">                <span class="keyword">elif</span> mode==<span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> mask</span><br><span class="line">    <span class="comment">#没有人脸              </span></span><br><span class="line">    <span class="keyword">if</span> mode==<span class="number">1</span>:  </span><br><span class="line">        <span class="keyword">return</span> image</span><br><span class="line">    <span class="keyword">elif</span> mode==<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> np.zeros(image.shape,dtype=np.uint8)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/23/%E4%BA%BA%E8%84%B8%E5%85%B3%E9%94%AE%E7%82%B9%E6%A3%80%E6%B5%8B%E5%8F%8A%E4%BA%BA%E8%84%B8%E5%88%86%E5%89%B2/" data-id="cm9zmq8zl00d8sqhle5r5ffvx" data-title="人脸关键点检测及人脸分割" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B/" rel="tag">人脸检测</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-百度短语音转文字API调用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/23/%E7%99%BE%E5%BA%A6%E7%9F%AD%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97API%E8%B0%83%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2023-03-23T05:30:00.000Z" itemprop="datePublished">2023-03-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/23/%E7%99%BE%E5%BA%A6%E7%9F%AD%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97API%E8%B0%83%E7%94%A8/">百度短语音转文字API调用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>百度的语音转文字API只支持最长60s的语音，如果要识别长语音，需要先切分，识别后再把结果合并。音频采样率和声道数好像也有影响，需要做修改，以下是一个成功案例。</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipSpeech  <span class="comment"># baidu_aip</span></span><br><span class="line"><span class="keyword">from</span> pydub <span class="keyword">import</span> AudioSegment</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#输入音频，输出文本</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audio_to_text</span>(<span class="params">audio_path</span>):</span><br><span class="line">    APP_ID = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    API_KEY = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    SECRET_KEY = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    client = AipSpeech(APP_ID, API_KEY, SECRET_KEY)</span><br><span class="line">    audio = AudioSegment.from_wav(audio_path)</span><br><span class="line">    <span class="comment">#获取时长</span></span><br><span class="line">    audio_length = audio.duration_seconds</span><br><span class="line">    <span class="comment">#采样率改成16000</span></span><br><span class="line">    audio=audio.set_frame_rate(<span class="number">16000</span>)</span><br><span class="line">    <span class="comment">#声道改成单声道</span></span><br><span class="line">    audio=audio.set_channels(<span class="number">1</span>)</span><br><span class="line">    max_len=<span class="number">60</span></span><br><span class="line">    audios=[]</span><br><span class="line">    <span class="keyword">if</span> audio_length&gt;max_len:</span><br><span class="line">    <span class="comment">#分片，每片60s</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(audio_length//max_len)):</span><br><span class="line">            audios.append(audio[i*max_len*<span class="number">1000</span>:(i+<span class="number">1</span>)*max_len*<span class="number">1000</span>])</span><br><span class="line">        audios.append(audio[<span class="built_in">int</span>(audio_length//max_len)*max_len*<span class="number">1000</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        audios.append(audio)</span><br><span class="line">    <span class="comment">#调用api</span></span><br><span class="line">    results=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(audios)):</span><br><span class="line">        audios[i].export(<span class="string">&#x27;temp.wav&#x27;</span>,<span class="built_in">format</span>=<span class="string">&#x27;wav&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;temp.wav&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            result = client.asr(fp.read(), <span class="string">&#x27;wav&#x27;</span>, <span class="number">16000</span>, &#123;<span class="string">&#x27;dev_pid&#x27;</span>: <span class="number">1537</span>,&#125;)</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;err_no&#x27;</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(result[<span class="string">&#x27;result&#x27;</span>][<span class="number">0</span>])</span><br><span class="line">            results=results+result[<span class="string">&#x27;result&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(result[<span class="string">&#x27;err_msg&#x27;</span>])  </span><br><span class="line">    os.remove(<span class="string">&#x27;temp.wav&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/23/%E7%99%BE%E5%BA%A6%E7%9F%AD%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97API%E8%B0%83%E7%94%A8/" data-id="cm9zmq90j00hisqhl5x0f2xtm" data-title="百度短语音转文字API调用" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97/" rel="tag">语音转文字</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-npm换源" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/21/npm%E6%8D%A2%E6%BA%90/" class="article-date">
  <time class="dt-published" datetime="2023-03-21T06:07:56.000Z" itemprop="datePublished">2023-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/21/npm%E6%8D%A2%E6%BA%90/">npm换源</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="npm换源"><a href="#npm换源" class="headerlink" title="npm换源"></a>npm换源</h1><h2 id="查看当前源"><a href="#查看当前源" class="headerlink" title="查看当前源"></a>查看当前源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>
<p>默认是指向 <a target="_blank" rel="noopener" href="https://registry.npmjs.org/%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%AE%98%E6%96%B9%E6%BA%90%E3%80%82">https://registry.npmjs.org/，也就是官方源。</a></p>
<h2 id="更换源"><a href="#更换源" class="headerlink" title="更换源"></a>更换源</h2><p>新淘宝源，一些文章还是写着旧的淘宝 NPM 镜像 registry.npm.taobao.org，但它已于 2022 年 05 月 31 日 废弃，读者需要更换为新的 registry.npmmirror.com 源。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npmmirror.com/</span><br></pre></td></tr></table></figure>
<p>这个配置会持久化保存到 ~&#x2F;.npmrc 文件中，你也可以通过手动改该文件来修改配置。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/21/npm%E6%8D%A2%E6%BA%90/" data-id="cm9zmq8xy005jsqhlhfytcc2k" data-title="npm换源" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-yolov5单目标检测简化改进" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/12/07/yolov5%E5%8D%95%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%80%E5%8C%96%E6%94%B9%E8%BF%9B/" class="article-date">
  <time class="dt-published" datetime="2022-12-07T06:22:00.000Z" itemprop="datePublished">2022-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/12/07/yolov5%E5%8D%95%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%80%E5%8C%96%E6%94%B9%E8%BF%9B/">yolov5单目标检测简化改进</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>backbone部分,去掉了7.8两层的conv和c3,只做到16倍下采样</p>
<p>head部分,去掉所有concat,3个检测层改为1个</p>
<p>Model size:3.63M-&gt;1.01M</p>
<p>Params:1.7M-&gt;0.45M</p>
<p>FLOPs:4.1G-&gt;2.8G</p>
<p>mAP:81.46-&gt;81.96</p>
<p>主要原因应该是对于我的检测任务，待检测目标的大小几乎不会有很大的变化，且和16倍下采样后每个cell的感受野大小一致。</p>
<h3 id="原yolov5n-yaml"><a href="#原yolov5n-yaml" class="headerlink" title="原yolov5n.yaml"></a>原yolov5n.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameters</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">1</span>  <span class="comment"># number of classes</span></span><br><span class="line"><span class="attr">depth_multiple:</span> <span class="number">0.33</span>  <span class="comment"># model depth multiple</span></span><br><span class="line"><span class="attr">width_multiple:</span> <span class="number">0.25</span>  <span class="comment"># layer channel multiple</span></span><br><span class="line"><span class="attr">anchors:</span></span><br><span class="line">  <span class="bullet">-</span> [<span class="number">10</span>,<span class="number">13</span>, <span class="number">16</span>,<span class="number">30</span>, <span class="number">33</span>,<span class="number">23</span>]  <span class="comment"># P3/8</span></span><br><span class="line">  <span class="bullet">-</span> [<span class="number">30</span>,<span class="number">61</span>, <span class="number">62</span>,<span class="number">45</span>, <span class="number">59</span>,<span class="number">119</span>]  <span class="comment"># P4/16</span></span><br><span class="line">  <span class="bullet">-</span> [<span class="number">116</span>,<span class="number">90</span>, <span class="number">156</span>,<span class="number">198</span>, <span class="number">373</span>,<span class="number">326</span>]  <span class="comment"># P5/32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># YOLOv5 v6.0 backbone</span></span><br><span class="line"><span class="attr">backbone:</span></span><br><span class="line">  <span class="comment"># [from, number, module, args]</span></span><br><span class="line">  [[<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">64</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">2</span>]],  <span class="comment"># 0-P1/2</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">128</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 1-P2/4</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">128</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">256</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 3-P3/8</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">6</span>, <span class="string">C3</span>, [<span class="number">256</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">512</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 5-P4/16</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">9</span>, <span class="string">C3</span>, [<span class="number">512</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">1024</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 7-P5/32</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">1024</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">SPPF</span>, [<span class="number">1024</span>, <span class="number">5</span>]],  <span class="comment"># 9</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># YOLOv5 v6.0 head</span></span><br><span class="line"><span class="attr">head:</span></span><br><span class="line">  [[<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">512</span>, <span class="number">1</span>, <span class="number">1</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">nn.Upsample</span>, [<span class="string">None</span>, <span class="number">2</span>, <span class="string">&#x27;nearest&#x27;</span>]],</span><br><span class="line">   [[<span class="number">-1</span>, <span class="number">6</span>], <span class="number">1</span>, <span class="string">Concat</span>, [<span class="number">1</span>]],  <span class="comment"># cat backbone P4</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">512</span>, <span class="literal">False</span>]],  <span class="comment"># 13</span></span><br><span class="line"></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">nn.Upsample</span>, [<span class="string">None</span>, <span class="number">2</span>, <span class="string">&#x27;nearest&#x27;</span>]],</span><br><span class="line">   [[<span class="number">-1</span>, <span class="number">4</span>], <span class="number">1</span>, <span class="string">Concat</span>, [<span class="number">1</span>]],  <span class="comment"># cat backbone P3</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">256</span>, <span class="literal">False</span>]],  <span class="comment"># 17 (P3/8-small)</span></span><br><span class="line"></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">256</span>, <span class="number">3</span>, <span class="number">2</span>]],</span><br><span class="line">   [[<span class="number">-1</span>, <span class="number">14</span>], <span class="number">1</span>, <span class="string">Concat</span>, [<span class="number">1</span>]],  <span class="comment"># cat head P4</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">512</span>, <span class="literal">False</span>]],  <span class="comment"># 20 (P4/16-medium)</span></span><br><span class="line"></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">512</span>, <span class="number">3</span>, <span class="number">2</span>]],</span><br><span class="line">   [[<span class="number">-1</span>, <span class="number">10</span>], <span class="number">1</span>, <span class="string">Concat</span>, [<span class="number">1</span>]],  <span class="comment"># cat head P5</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">1024</span>, <span class="literal">False</span>]],  <span class="comment"># 23 (P5/32-large)</span></span><br><span class="line"></span><br><span class="line">   [[<span class="number">17</span>, <span class="number">20</span>, <span class="number">23</span>], <span class="number">1</span>, <span class="string">Detect</span>, [<span class="string">nc</span>, <span class="string">anchors</span>]],  <span class="comment"># Detect(P3, P4, P5)</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<h3 id="yolov5-new-yaml"><a href="#yolov5-new-yaml" class="headerlink" title="yolov5_new.yaml"></a>yolov5_new.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameters</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">1</span>  <span class="comment"># number of classes</span></span><br><span class="line"><span class="attr">depth_multiple:</span> <span class="number">1</span>  <span class="comment"># model depth multiple</span></span><br><span class="line"><span class="attr">width_multiple:</span> <span class="number">1</span>  <span class="comment"># layer channel multiple</span></span><br><span class="line"><span class="attr">anchors:</span></span><br><span class="line">  <span class="bullet">-</span> [<span class="number">71.741</span>,<span class="number">66.536</span>,<span class="number">69.588</span>,<span class="number">70.286</span>,<span class="number">73.263</span>,<span class="number">72.851</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># YOLOv5 v6.0 backbone</span></span><br><span class="line"><span class="attr">backbone:</span></span><br><span class="line">  <span class="comment"># [from, number, module, args]</span></span><br><span class="line">  [[<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">16</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">2</span>]],  <span class="comment"># 0-P1/2</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">32</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 1-P2/4</span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">C3</span>, [<span class="number">32</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">64</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 3-P3/8 </span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">2</span>, <span class="string">C3</span>, [<span class="number">64</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">128</span>, <span class="number">3</span>, <span class="number">2</span>]],  <span class="comment"># 5-P4/16 </span></span><br><span class="line">   [<span class="number">-1</span>, <span class="number">3</span>, <span class="string">C3</span>, [<span class="number">128</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">SPPF</span>, [<span class="number">256</span>, <span class="number">5</span>]],  <span class="comment"># 7</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># YOLOv5 v6.0 head</span></span><br><span class="line"><span class="attr">head:</span></span><br><span class="line">  [</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">Conv</span>, [<span class="number">128</span>, <span class="number">1</span>, <span class="number">1</span>]],</span><br><span class="line">   [<span class="number">-1</span>, <span class="number">1</span>, <span class="string">C3</span>, [<span class="number">128</span>, <span class="literal">False</span>]],  <span class="comment"># 9 (P4/16-medium)</span></span><br><span class="line"></span><br><span class="line">   [[<span class="number">9</span>], <span class="number">1</span>, <span class="string">Detect</span>, [<span class="string">nc</span>, <span class="string">anchors</span>]],  <span class="comment"># Detect(P4)</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/12/07/yolov5%E5%8D%95%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%80%E5%8C%96%E6%94%B9%E8%BF%9B/" data-id="cm9zmq8za00bjsqhl7f8hbtuf" data-title="yolov5单目标检测简化改进" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-yolox小目标检测改进（删除感受野大的特征图）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/24/yolox%E5%B0%8F%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%94%B9%E8%BF%9B%EF%BC%88%E5%88%A0%E9%99%A4%E6%84%9F%E5%8F%97%E9%87%8E%E5%A4%A7%E7%9A%84%E7%89%B9%E5%BE%81%E5%9B%BE%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2022-10-24T03:30:00.000Z" itemprop="datePublished">2022-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/24/yolox%E5%B0%8F%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%94%B9%E8%BF%9B%EF%BC%88%E5%88%A0%E9%99%A4%E6%84%9F%E5%8F%97%E9%87%8E%E5%A4%A7%E7%9A%84%E7%89%B9%E5%BE%81%E5%9B%BE%EF%BC%89/">yolox小目标检测改进（删除感受野大的特征图）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>yolox中有3个检测分支，分别预测小、中、大的目标<br><img src="https://xinhaojin.github.io/imgs-host/20221010/41.png"><br>但在我的数据集上，并不需要预测大目标，甚至还要手动去掉错误的大预测框，因此有一个想法是去掉一个最深的检测分支，使网络预测大目标的能力下降，整体感受野变小，对小目标更加敏感。</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p><strong>修改yolox&#x2F;models&#x2F;yolo_head.py</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOXHead</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        num_classes,</span></span><br><span class="line"><span class="params">        width=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">        <span class="comment"># strides=[8, 16, 32],</span></span></span><br><span class="line"><span class="params">        <span class="comment"># in_channels=[256, 512, 1024],</span></span></span><br><span class="line"><span class="params">        strides=[<span class="number">8</span>, <span class="number">16</span>],</span></span><br><span class="line"><span class="params">        in_channels=[<span class="number">256</span>, <span class="number">512</span>],</span></span><br><span class="line"><span class="params">        act=<span class="string">&quot;silu&quot;</span>,</span></span><br><span class="line"><span class="params">        depthwise=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            act (str): activation type of conv. Defalut value: &quot;silu&quot;.</span></span><br><span class="line"><span class="string">            depthwise (bool): whether apply depthwise conv in conv branch. Defalut value: False.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br></pre></td></tr></table></figure>

<p><strong>修改yolox&#x2F;models&#x2F;darknet.py</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CSPDarknet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        dep_mul,</span></span><br><span class="line"><span class="params">        wid_mul,</span></span><br><span class="line"><span class="params">        out_features=(<span class="params"><span class="string">&quot;dark3&quot;</span>, <span class="string">&quot;dark4&quot;</span></span>),</span></span><br><span class="line"><span class="params">        <span class="comment"># out_features=(&quot;dark3&quot;, &quot;dark4&quot;, &quot;dark5&quot;),</span></span></span><br><span class="line"><span class="params">        depthwise=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        act=<span class="string">&quot;silu&quot;</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">    <span class="comment">#......</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        outputs = &#123;&#125;</span><br><span class="line">        x = <span class="variable language_">self</span>.stem(x)</span><br><span class="line">        outputs[<span class="string">&quot;stem&quot;</span>] = x</span><br><span class="line">        x = <span class="variable language_">self</span>.dark2(x)</span><br><span class="line">        outputs[<span class="string">&quot;dark2&quot;</span>] = x</span><br><span class="line">        x = <span class="variable language_">self</span>.dark3(x)</span><br><span class="line">        outputs[<span class="string">&quot;dark3&quot;</span>] = x</span><br><span class="line">        x = <span class="variable language_">self</span>.dark4(x)</span><br><span class="line">        outputs[<span class="string">&quot;dark4&quot;</span>] = x</span><br><span class="line">        <span class="comment"># x = self.dark5(x)</span></span><br><span class="line">        <span class="comment"># outputs[&quot;dark5&quot;] = x</span></span><br><span class="line">        <span class="keyword">return</span> &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> outputs.items() <span class="keyword">if</span> k <span class="keyword">in</span> <span class="variable language_">self</span>.out_features&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改yolox&#x2F;models&#x2F;yolo_pafpn.py</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOPAFPN</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    YOLOv3 model. Darknet 53 is the default backbone of this model.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        depth=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">        width=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">        <span class="comment"># in_features=(&quot;dark3&quot;, &quot;dark4&quot;, &quot;dark5&quot;),</span></span></span><br><span class="line"><span class="params">        <span class="comment"># in_channels=[256, 512, 1024],</span></span></span><br><span class="line"><span class="params">        in_features=(<span class="params"><span class="string">&quot;dark3&quot;</span>, <span class="string">&quot;dark4&quot;</span></span>),</span></span><br><span class="line"><span class="params">        in_channels=[<span class="number">256</span>, <span class="number">512</span>],</span></span><br><span class="line"><span class="params">        depthwise=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        act=<span class="string">&quot;silu&quot;</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.backbone = CSPDarknet(depth, width, depthwise=depthwise, act=act)</span><br><span class="line">        <span class="variable language_">self</span>.in_features = in_features</span><br><span class="line">        <span class="variable language_">self</span>.in_channels = in_channels</span><br><span class="line">        Conv = DWConv <span class="keyword">if</span> depthwise <span class="keyword">else</span> BaseConv</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.upsample = nn.Upsample(scale_factor=<span class="number">2</span>, mode=<span class="string">&quot;nearest&quot;</span>)</span><br><span class="line">        <span class="comment"># self.lateral_conv0 = BaseConv(</span></span><br><span class="line">        <span class="comment">#     int(in_channels[2] * width), int(in_channels[1] * width), 1, 1, act=act</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># self.C3_p4 = CSPLayer(</span></span><br><span class="line">        <span class="comment">#     int(2 * in_channels[1] * width),</span></span><br><span class="line">        <span class="comment">#     int(in_channels[1] * width),</span></span><br><span class="line">        <span class="comment">#     round(3 * depth),</span></span><br><span class="line">        <span class="comment">#     False,</span></span><br><span class="line">        <span class="comment">#     depthwise=depthwise,</span></span><br><span class="line">        <span class="comment">#     act=act,</span></span><br><span class="line">        <span class="comment"># )  # cat</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.reduce_conv1 = BaseConv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="number">1</span>, <span class="number">1</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_p3 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># bottom-up conv</span></span><br><span class="line">        <span class="variable language_">self</span>.bu_conv2 = Conv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="number">3</span>, <span class="number">2</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_n3 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># bottom-up conv</span></span><br><span class="line">        <span class="comment"># self.bu_conv1 = Conv(</span></span><br><span class="line">        <span class="comment">#     int(in_channels[1] * width), int(in_channels[1] * width), 3, 2, act=act</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># self.C3_n4 = CSPLayer(</span></span><br><span class="line">        <span class="comment">#     int(2 * in_channels[1] * width),</span></span><br><span class="line">        <span class="comment">#     int(in_channels[2] * width),</span></span><br><span class="line">        <span class="comment">#     round(3 * depth),</span></span><br><span class="line">        <span class="comment">#     False,</span></span><br><span class="line">        <span class="comment">#     depthwise=depthwise,</span></span><br><span class="line">        <span class="comment">#     act=act,</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            inputs: input images.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Tuple[Tensor]: FPN feature.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#  backbone</span></span><br><span class="line">        out_features = <span class="variable language_">self</span>.backbone(<span class="built_in">input</span>)</span><br><span class="line">        features = [out_features[f] <span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable language_">self</span>.in_features]</span><br><span class="line">        <span class="comment">#[x2, x1, x0] = features</span></span><br><span class="line">        [x2,x1] = features<span class="comment">#256,512</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># fpn_out0 = self.lateral_conv0(x0)  # 1024-&gt;512/32</span></span><br><span class="line">        <span class="comment"># f_out0 = self.upsample(fpn_out0)  # 512/16</span></span><br><span class="line">        <span class="comment"># f_out0 = torch.cat([f_out0, x1], 1)  # 512-&gt;1024/16</span></span><br><span class="line">        <span class="comment"># f_out0 = self.C3_p4(f_out0)  # 1024-&gt;512/16</span></span><br><span class="line"></span><br><span class="line">        fpn_out1 = <span class="variable language_">self</span>.reduce_conv1(x1)  <span class="comment"># 512-&gt;256/16</span></span><br><span class="line">        <span class="comment"># fpn_out1 = self.reduce_conv1(f_out0)  # 512-&gt;256/16</span></span><br><span class="line">        f_out1 = <span class="variable language_">self</span>.upsample(fpn_out1)  <span class="comment"># 256/8</span></span><br><span class="line">        f_out1 = torch.cat([f_out1, x2], <span class="number">1</span>)  <span class="comment"># 256-&gt;512/8</span></span><br><span class="line">        pan_out2 = <span class="variable language_">self</span>.C3_p3(f_out1)  <span class="comment"># 512-&gt;256/8</span></span><br><span class="line"></span><br><span class="line">        p_out1 = <span class="variable language_">self</span>.bu_conv2(pan_out2)  <span class="comment"># 256-&gt;256/16</span></span><br><span class="line">        p_out1 = torch.cat([p_out1, fpn_out1], <span class="number">1</span>)  <span class="comment"># 256-&gt;512/16</span></span><br><span class="line">        pan_out1 = <span class="variable language_">self</span>.C3_n3(p_out1)  <span class="comment"># 512-&gt;512/16</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># p_out0 = self.bu_conv1(pan_out1)  # 512-&gt;512/32</span></span><br><span class="line">        <span class="comment"># p_out0 = torch.cat([p_out0, fpn_out0], 1)  # 512-&gt;1024/32</span></span><br><span class="line">        <span class="comment"># pan_out0 = self.C3_n4(p_out0)  # 1024-&gt;1024/32</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># outputs = (pan_out2, pan_out1, pan_out0)</span></span><br><span class="line">        outputs = (pan_out2, pan_out1)</span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>

<p><strong>修改yolox&#x2F;exp&#x2F;yolox_base.py</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Exp</span>(<span class="title class_ inherited__">BaseExp</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ---------------- model config ---------------- #</span></span><br><span class="line">        <span class="comment">#......</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_model</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">from</span> yolox.models <span class="keyword">import</span> YOLOX, YOLOPAFPN, YOLOXHead</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">init_yolo</span>(<span class="params">M</span>):</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> M.modules():</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(m, nn.BatchNorm2d):</span><br><span class="line">                    m.eps = <span class="number">1e-3</span></span><br><span class="line">                    m.momentum = <span class="number">0.03</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">getattr</span>(<span class="variable language_">self</span>, <span class="string">&quot;model&quot;</span>, <span class="literal">None</span>) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            in_channels = [<span class="number">256</span>, <span class="number">512</span>]</span><br><span class="line">            <span class="comment"># in_channels = [256, 512, 1024]</span></span><br><span class="line">            backbone = YOLOPAFPN(<span class="variable language_">self</span>.depth, <span class="variable language_">self</span>.width, in_channels=in_channels, act=<span class="variable language_">self</span>.act)</span><br><span class="line">            head = YOLOXHead(<span class="variable language_">self</span>.num_classes, <span class="variable language_">self</span>.width, in_channels=in_channels, act=<span class="variable language_">self</span>.act)</span><br><span class="line">            <span class="variable language_">self</span>.model = YOLOX(backbone, head)</span><br></pre></td></tr></table></figure>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>使用tiny模型，没有AP提升，也没有明显下降，但模型减小了近一半，是有效的改进。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45207837/article/details/124840732">https://blog.csdn.net/qq_45207837&#x2F;article&#x2F;details&#x2F;124840732</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/24/yolox%E5%B0%8F%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%94%B9%E8%BF%9B%EF%BC%88%E5%88%A0%E9%99%A4%E6%84%9F%E5%8F%97%E9%87%8E%E5%A4%A7%E7%9A%84%E7%89%B9%E5%BE%81%E5%9B%BE%EF%BC%89/" data-id="cm9zmq8zc00bxsqhl63y4e6qt" data-title="yolox小目标检测改进（删除感受野大的特征图）" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-yolox添加注意力机制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/24/yolox%E6%B7%BB%E5%8A%A0%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2022-10-24T03:24:00.000Z" itemprop="datePublished">2022-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/24/yolox%E6%B7%BB%E5%8A%A0%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/">yolox添加注意力机制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43114108/article/details/126533757">原文链接</a></p>
<h2 id="Coordinate-Attention"><a href="#Coordinate-Attention" class="headerlink" title="Coordinate Attention"></a>Coordinate Attention</h2><p><a target="_blank" rel="noopener" href="http://arxiv.org/abs/2103.02907">论文来源</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Andrew-Qibin/CoordAttention">官方代码</a></p>
<p>注意力机制广泛用于深度神经网络中来提高模型的性能。然而，因为其昂贵的计算代价，很难应用在一些轻量级网络，但不乏有一些注意力模块脱颖而出，具有代表性的有SE、CBAM等。SE模块通过2D全局池化来计算通道注意力，在非常低的计算成本下达到了提升网络性能的目的，遗憾的是，SE模块忽视了捕获位置信息的注意力；CBAM模块通过使用大尺寸卷积来获得位置信息的注意力，但只偏向于捕获局部的位置信息。<br>CAM模块来源于2021CVPR，该模块通过将位置信息嵌入到通道注意力中，因为其较少的计算代价，使轻量级网可以较大的区域中获得注意力。为了缓解位置信息丢失的问题，论文作者将2D全局池化替换成分别在特征的w和h并行提取特征的两个1D池化，可以有效捕获空间坐标信息；而后这两个并行的特征图通过两个卷积来生成两个独立方向的注意力图；通过将两个注意力图乘入到原始特征图中，以达到增强特征图的表征能力。<br><img src="https://xinhaojin.github.io/imgs-host/20221019/xxx.44vbajj18g40.png"></p>
<h2 id="在yolox-models-下添加attention-py"><a href="#在yolox-models-下添加attention-py" class="headerlink" title="在yolox&#x2F;models&#x2F;下添加attention.py"></a>在yolox&#x2F;models&#x2F;下添加attention.py</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CAM</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channels, reduction=<span class="number">32</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CAM, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv_1x1 = nn.Conv2d(in_channels=channels, out_channels=channels // reduction, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>,</span><br><span class="line">                                  bias=<span class="literal">False</span>)                      </span><br><span class="line">        <span class="variable language_">self</span>.mish = nn.Mish() <span class="comment"># 可用自行选择激活函数</span></span><br><span class="line">        <span class="variable language_">self</span>.bn = nn.BatchNorm2d(channels // reduction)  </span><br><span class="line">        <span class="variable language_">self</span>.F_h = nn.Conv2d(in_channels=channels // reduction, out_channels=channels, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.F_w = nn.Conv2d(in_channels=channels // reduction, out_channels=channels, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, bias=<span class="literal">False</span>)  </span><br><span class="line">        <span class="variable language_">self</span>.sigmoid_h = nn.Sigmoid() </span><br><span class="line">        <span class="variable language_">self</span>.sigmoid_w = nn.Sigmoid()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        h, w = x.shape[<span class="number">2</span>], x.shape[<span class="number">3</span>]</span><br><span class="line">        avg_pool_x = nn.AdaptiveAvgPool2d((h, <span class="number">1</span>))</span><br><span class="line">        avg_pool_y = nn.AdaptiveAvgPool2d((<span class="number">1</span>, w))</span><br><span class="line">        x_h = avg_pool_x(x).permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>) </span><br><span class="line">        x_w = avg_pool_y(x)  </span><br><span class="line">        x_cat_conv_relu = <span class="variable language_">self</span>.mish(<span class="variable language_">self</span>.conv_1x1(torch.cat((x_h, x_w), <span class="number">3</span>))) </span><br><span class="line">        x_cat_conv_split_h, x_cat_conv_split_w = x_cat_conv_relu.split([h, w], <span class="number">3</span>)</span><br><span class="line">        s_h = <span class="variable language_">self</span>.sigmoid_h(<span class="variable language_">self</span>.F_h(x_cat_conv_split_h.permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>)))</span><br><span class="line">        s_w = <span class="variable language_">self</span>.sigmoid_w(<span class="variable language_">self</span>.F_w(x_cat_conv_split_w))</span><br><span class="line">        out = x * s_h.expand_as(x) * s_w.expand_as(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<h2 id="在yolox-models-yolo-pafpn-py中添加CAM"><a href="#在yolox-models-yolo-pafpn-py中添加CAM" class="headerlink" title="在yolox&#x2F;models&#x2F;yolo_pafpn.py中添加CAM"></a>在yolox&#x2F;models&#x2F;yolo_pafpn.py中添加CAM</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Copyright (c) 2014-2021 Megvii Inc. All rights reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .darknet <span class="keyword">import</span> CSPDarknet</span><br><span class="line"><span class="keyword">from</span> .network_blocks <span class="keyword">import</span> BaseConv, CSPLayer, DWConv</span><br><span class="line"><span class="keyword">from</span> .attention <span class="keyword">import</span> CAM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOPAFPN</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    YOLOv3 model. Darknet 53 is the default backbone of this model.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        depth=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">        width=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">        in_features=(<span class="params"><span class="string">&quot;dark3&quot;</span>, <span class="string">&quot;dark4&quot;</span>, <span class="string">&quot;dark5&quot;</span></span>),</span></span><br><span class="line"><span class="params">        in_channels=[<span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>],</span></span><br><span class="line"><span class="params">        depthwise=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        act=<span class="string">&quot;silu&quot;</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.backbone = CSPDarknet(depth, width, depthwise=depthwise, act=act)</span><br><span class="line">        <span class="variable language_">self</span>.in_features = in_features</span><br><span class="line">        <span class="variable language_">self</span>.in_channels = in_channels</span><br><span class="line">        Conv = DWConv <span class="keyword">if</span> depthwise <span class="keyword">else</span> BaseConv</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.upsample = nn.Upsample(scale_factor=<span class="number">2</span>, mode=<span class="string">&quot;nearest&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.lateral_conv0 = BaseConv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">2</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width), <span class="number">1</span>, <span class="number">1</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_p4 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">1</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )  <span class="comment"># cat</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.reduce_conv1 = BaseConv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="number">1</span>, <span class="number">1</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_p3 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># bottom-up conv</span></span><br><span class="line">        <span class="variable language_">self</span>.bu_conv2 = Conv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width), <span class="number">3</span>, <span class="number">2</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_n3 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">0</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># bottom-up conv</span></span><br><span class="line">        <span class="variable language_">self</span>.bu_conv1 = Conv(</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width), <span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width), <span class="number">3</span>, <span class="number">2</span>, act=act</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.C3_n4 = CSPLayer(</span><br><span class="line">            <span class="built_in">int</span>(<span class="number">2</span> * in_channels[<span class="number">1</span>] * width),</span><br><span class="line">            <span class="built_in">int</span>(in_channels[<span class="number">2</span>] * width),</span><br><span class="line">            <span class="built_in">round</span>(<span class="number">3</span> * depth),</span><br><span class="line">            <span class="literal">False</span>,</span><br><span class="line">            depthwise=depthwise,</span><br><span class="line">            act=act,</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">##################################################</span></span><br><span class="line">        <span class="variable language_">self</span>.CAM0 = CAM(<span class="built_in">int</span>(in_channels[<span class="number">2</span>] * width))</span><br><span class="line">        <span class="variable language_">self</span>.CAM1 = CAM(<span class="built_in">int</span>(in_channels[<span class="number">1</span>] * width))</span><br><span class="line">        <span class="variable language_">self</span>.CAM2 = CAM(<span class="built_in">int</span>(in_channels[<span class="number">0</span>] * width))</span><br><span class="line">        <span class="comment">##################################################</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            inputs: input images.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Tuple[Tensor]: FPN feature.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#  backbone</span></span><br><span class="line">        out_features = <span class="variable language_">self</span>.backbone(<span class="built_in">input</span>)</span><br><span class="line">        features = [out_features[f] <span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable language_">self</span>.in_features]</span><br><span class="line">        [x2, x1, x0] = features</span><br><span class="line">        <span class="comment">##################################################</span></span><br><span class="line">        x0 = <span class="variable language_">self</span>.CAM0(x0)</span><br><span class="line">        x1 = <span class="variable language_">self</span>.CAM1(x1)</span><br><span class="line">        x2 = <span class="variable language_">self</span>.CAM2(x2)</span><br><span class="line">        <span class="comment">##################################################</span></span><br><span class="line"></span><br><span class="line">        fpn_out0 = <span class="variable language_">self</span>.lateral_conv0(x0)  <span class="comment"># 1024-&gt;512/32</span></span><br><span class="line">        f_out0 = <span class="variable language_">self</span>.upsample(fpn_out0)  <span class="comment"># 512/16</span></span><br><span class="line">        f_out0 = torch.cat([f_out0, x1], <span class="number">1</span>)  <span class="comment"># 512-&gt;1024/16</span></span><br><span class="line">        f_out0 = <span class="variable language_">self</span>.C3_p4(f_out0)  <span class="comment"># 1024-&gt;512/16</span></span><br><span class="line"></span><br><span class="line">        fpn_out1 = <span class="variable language_">self</span>.reduce_conv1(f_out0)  <span class="comment"># 512-&gt;256/16</span></span><br><span class="line">        f_out1 = <span class="variable language_">self</span>.upsample(fpn_out1)  <span class="comment"># 256/8</span></span><br><span class="line">        f_out1 = torch.cat([f_out1, x2], <span class="number">1</span>)  <span class="comment"># 256-&gt;512/8</span></span><br><span class="line">        pan_out2 = <span class="variable language_">self</span>.C3_p3(f_out1)  <span class="comment"># 512-&gt;256/8</span></span><br><span class="line"></span><br><span class="line">        p_out1 = <span class="variable language_">self</span>.bu_conv2(pan_out2)  <span class="comment"># 256-&gt;256/16</span></span><br><span class="line">        p_out1 = torch.cat([p_out1, fpn_out1], <span class="number">1</span>)  <span class="comment"># 256-&gt;512/16</span></span><br><span class="line">        pan_out1 = <span class="variable language_">self</span>.C3_n3(p_out1)  <span class="comment"># 512-&gt;512/16</span></span><br><span class="line"></span><br><span class="line">        p_out0 = <span class="variable language_">self</span>.bu_conv1(pan_out1)  <span class="comment"># 512-&gt;512/32</span></span><br><span class="line">        p_out0 = torch.cat([p_out0, fpn_out0], <span class="number">1</span>)  <span class="comment"># 512-&gt;1024/32</span></span><br><span class="line">        pan_out0 = <span class="variable language_">self</span>.C3_n4(p_out0)  <span class="comment"># 1024-&gt;1024/32</span></span><br><span class="line"></span><br><span class="line">        outputs = (pan_out2, pan_out1, pan_out0)</span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>

<h2 id="其他注意力机制（SE、CBAM、ECA）同理，代码如下-插入使用方法相同"><a href="#其他注意力机制（SE、CBAM、ECA）同理，代码如下-插入使用方法相同" class="headerlink" title="其他注意力机制（SE、CBAM、ECA）同理，代码如下,插入使用方法相同"></a>其他注意力机制（SE、CBAM、ECA）同理，代码如下,插入使用方法相同</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CAM</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channels, reduction=<span class="number">32</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CAM, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv_1x1 = nn.Conv2d(in_channels=channels, out_channels=channels // reduction, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>,</span><br><span class="line">                                  bias=<span class="literal">False</span>)                      </span><br><span class="line">        <span class="variable language_">self</span>.mish = nn.Mish() <span class="comment"># 可用自行选择激活函数</span></span><br><span class="line">        <span class="variable language_">self</span>.bn = nn.BatchNorm2d(channels // reduction)  </span><br><span class="line">        <span class="variable language_">self</span>.F_h = nn.Conv2d(in_channels=channels // reduction, out_channels=channels, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.F_w = nn.Conv2d(in_channels=channels // reduction, out_channels=channels, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, bias=<span class="literal">False</span>)  </span><br><span class="line">        <span class="variable language_">self</span>.sigmoid_h = nn.Sigmoid() </span><br><span class="line">        <span class="variable language_">self</span>.sigmoid_w = nn.Sigmoid()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        h, w = x.shape[<span class="number">2</span>], x.shape[<span class="number">3</span>]</span><br><span class="line">        avg_pool_x = nn.AdaptiveAvgPool2d((h, <span class="number">1</span>))</span><br><span class="line">        avg_pool_y = nn.AdaptiveAvgPool2d((<span class="number">1</span>, w))</span><br><span class="line">        x_h = avg_pool_x(x).permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>) </span><br><span class="line">        x_w = avg_pool_y(x)  </span><br><span class="line">        x_cat_conv_relu = <span class="variable language_">self</span>.mish(<span class="variable language_">self</span>.conv_1x1(torch.cat((x_h, x_w), <span class="number">3</span>))) </span><br><span class="line">        x_cat_conv_split_h, x_cat_conv_split_w = x_cat_conv_relu.split([h, w], <span class="number">3</span>)</span><br><span class="line">        s_h = <span class="variable language_">self</span>.sigmoid_h(<span class="variable language_">self</span>.F_h(x_cat_conv_split_h.permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>)))</span><br><span class="line">        s_w = <span class="variable language_">self</span>.sigmoid_w(<span class="variable language_">self</span>.F_w(x_cat_conv_split_w))</span><br><span class="line">        out = x * s_h.expand_as(x) * s_w.expand_as(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SE</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, ratio=<span class="number">16</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(SE, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc = nn.Sequential(</span><br><span class="line">                nn.Linear(channel, channel // ratio, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">                nn.Linear(channel // ratio, channel, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        b, c, _, _ = x.size()</span><br><span class="line">        y = <span class="variable language_">self</span>.avg_pool(x).view(b, c)</span><br><span class="line">        y = <span class="variable language_">self</span>.fc(y).view(b, c, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x * y</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECA</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, b=<span class="number">1</span>, gamma=<span class="number">2</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ECA, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        kernel_size = <span class="built_in">int</span>(<span class="built_in">abs</span>((math.log(channel, <span class="number">2</span>) + b) / gamma))</span><br><span class="line">        kernel_size = kernel_size <span class="keyword">if</span> kernel_size % <span class="number">2</span> <span class="keyword">else</span> kernel_size + <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">        <span class="variable language_">self</span>.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv = nn.Conv1d(<span class="number">1</span>, <span class="number">1</span>, kernel_size=kernel_size, padding=(kernel_size - <span class="number">1</span>) // <span class="number">2</span>, bias=<span class="literal">False</span>) </span><br><span class="line">        <span class="variable language_">self</span>.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        y = <span class="variable language_">self</span>.avg_pool(x)</span><br><span class="line">        y = <span class="variable language_">self</span>.conv(y.squeeze(-<span class="number">1</span>).transpose(-<span class="number">1</span>, -<span class="number">2</span>)).transpose(-<span class="number">1</span>, -<span class="number">2</span>).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        y = <span class="variable language_">self</span>.sigmoid(y)</span><br><span class="line">        <span class="keyword">return</span> x * y.expand_as(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChannelAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_planes, ratio=<span class="number">8</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ChannelAttention, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.max_pool = nn.AdaptiveMaxPool2d(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 利用1x1卷积代替全连接</span></span><br><span class="line">        <span class="variable language_">self</span>.fc1   = nn.Conv2d(in_planes, in_planes // ratio, <span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.relu1 = nn.ReLU()</span><br><span class="line">        <span class="variable language_">self</span>.fc2   = nn.Conv2d(in_planes // ratio, in_planes, <span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        avg_out = <span class="variable language_">self</span>.fc2(<span class="variable language_">self</span>.relu1(<span class="variable language_">self</span>.fc1(<span class="variable language_">self</span>.avg_pool(x))))</span><br><span class="line">        max_out = <span class="variable language_">self</span>.fc2(<span class="variable language_">self</span>.relu1(<span class="variable language_">self</span>.fc1(<span class="variable language_">self</span>.max_pool(x))))</span><br><span class="line">        out = avg_out + max_out</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.sigmoid(out)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpatialAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, kernel_size=<span class="number">7</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(SpatialAttention, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="keyword">assert</span> kernel_size <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">7</span>), <span class="string">&#x27;kernel size must be 3 or 7&#x27;</span></span><br><span class="line">        padding = <span class="number">3</span> <span class="keyword">if</span> kernel_size == <span class="number">7</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="number">2</span>, <span class="number">1</span>, kernel_size, padding=padding, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        avg_out = torch.mean(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        max_out, _ = torch.<span class="built_in">max</span>(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        x = torch.cat([avg_out, max_out], dim=<span class="number">1</span>)</span><br><span class="line">        x = <span class="variable language_">self</span>.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.sigmoid(x)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CBAM</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, ratio=<span class="number">8</span>, kernel_size=<span class="number">7</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CBAM, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.channelattention = ChannelAttention(channel, ratio=ratio)</span><br><span class="line">        <span class="variable language_">self</span>.spatialattention = SpatialAttention(kernel_size=kernel_size)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = x*<span class="variable language_">self</span>.channelattention(x)</span><br><span class="line">        x = x*<span class="variable language_">self</span>.spatialattention(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>试验了两个数据集，这些注意力机制通常都有零点几的AP提升，但不会有太大的作用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/24/yolox%E6%B7%BB%E5%8A%A0%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/" data-id="cm9zmq8zd00c1sqhl0w524hy5" data-title="yolox添加注意力机制" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-yolo系列综述(v1-v7)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/10/08/yolo%E7%B3%BB%E5%88%97%E7%BB%BC%E8%BF%B0(v1-v7)/" class="article-date">
  <time class="dt-published" datetime="2022-10-08T12:58:00.000Z" itemprop="datePublished">2022-10-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/10/08/yolo%E7%B3%BB%E5%88%97%E7%BB%BC%E8%BF%B0(v1-v7)/">yolo主流版本介绍(v1-v7)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>本文主要介绍目标检测yolo系列主流版本的发展。</p>
<h3 id="目标检测评价指标"><a href="#目标检测评价指标" class="headerlink" title="目标检测评价指标"></a>目标检测评价指标</h3><h4 id="IOU"><a href="#IOU" class="headerlink" title="IOU"></a>IOU</h4><p>真实框和预测框之间的交并比。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/4.png"></p>
<h4 id="精确度"><a href="#精确度" class="headerlink" title="精确度"></a>精确度</h4><p>预测为正例的那些数据里预测正确的比例。</p>
<h4 id="召回率"><a href="#召回率" class="headerlink" title="召回率"></a>召回率</h4><p>真实为正例的那些数据里预测正确的比例。</p>
<h4 id="AP"><a href="#AP" class="headerlink" title="AP"></a>AP</h4><p>不同的置信度阈值对应不同的检测结果，对应一组精确度和召回率，计算合成的面积<br><img src="https://xinhaojin.github.io/imgs-host/20221010/18.png"></p>
<h4 id="MAP"><a href="#MAP" class="headerlink" title="MAP"></a>MAP</h4><p>MAP是不同类别的平均AP。</p>
<h2 id="YOLOv1"><a href="#YOLOv1" class="headerlink" title="YOLOv1"></a>YOLOv1</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1506.02640">paper(CVPR2015)</a></p>
<p>You only look once,one-stage方法,把目标检测问题直接转化成CNN回归问题（预测数值）。</p>
<p><strong>思考一个问题：</strong> 怎么表示一个位置框(目标)？<br>x,y,w,h,conf,class<br><img src="https://xinhaojin.github.io/imgs-host/20221010/7.png"></p>
<h3 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h3><p>将一幅图像分成7x7个网格(grid cell),如果某个object的中心落在这个网格中，则这个网格就负责预测这个object。<br>每个网格要预测2个bounding box(指定长宽比例的预选框)，每个bounding box除了要预测位置之外，还要附带预测一个confidence值。每个网格还要预测20个类别的概率。</p>
<h3 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h3><p><img src="https://xinhaojin.github.io/imgs-host/20221010/19.png"><br>输入：448<em>448</em>3<code>&lt;br&gt;</code><br>经过卷积池化卷积池化…全连接<code>&lt;br&gt;</code><br>输出：7<em>7</em>30<code>&lt;br&gt;</code><br>7<em>7：格子<code>&lt;br&gt;</code><br>30&#x3D;20+5</em>2<code>&lt;br&gt;</code><br>20：类别<code>&lt;br&gt;</code><br>5：x,y,w,h,conf<code>&lt;br&gt;</code><br>2：两个预选框<code>&lt;br&gt;</code><br><strong>疑问:</strong> 神经网络怎么知道每个值代表什么意思?<br>设计合适的损失函数。</p>
<h3 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h3><p>bounding box损失、confidence损失和classes损失。在计算损失时主要都是用的误差平方和求解。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/20.png"><br><img src="https://xinhaojin.github.io/imgs-host/20221010/17.png"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>优点：快速，简单</p>
<p>缺点：每个cell只能预测一个类别，重叠问题无法解决；<br>小物体检测效果一般；无法应对新尺寸目标；定位不准确</p>
<h2 id="YOLOv2-YOLO9000"><a href="#YOLOv2-YOLO9000" class="headerlink" title="YOLOv2&#x2F;YOLO9000"></a>YOLOv2&#x2F;YOLO9000</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1612.08242">paper(CVPR2016)</a></p>
<p>在v1基础上做的改进</p>
<h3 id="批标准化"><a href="#批标准化" class="headerlink" title="批标准化"></a>批标准化</h3><p>V2版本舍弃Dropout，卷积后全部加入Batch Normalization，网络的每一层的输入都做了归一化，收敛相对更容易，经过Batch Normalization处理后的网络会提升2%的mAP，从现在的角度来看，Batch Normalization已经成网络必备处理。</p>
<h3 id="更大的输入尺寸"><a href="#更大的输入尺寸" class="headerlink" title="更大的输入尺寸"></a>更大的输入尺寸</h3><p>在YOLOv1中训练分类器时使用的是224×244的输入，而在 YOLOv2中作者采用了448×448的尺寸作为输入，论文总表明，采用更大的分辨率作为输入可以得到MAP值4%的提升。</p>
<h3 id="引入锚框"><a href="#引入锚框" class="headerlink" title="引入锚框"></a>引入锚框</h3><p>YOLOv1用全连接层预测边界框的中心坐标、宽度和高度，使用这种方式定位效果比较差，所以在YOLOv2中作者采用anchor进行目标框的预测，使得预测的box数量更多。弃用了全连接层，使用5次下采样，得到13<em>13(实际输入是416</em>416,416&#x3D;13*2^5)，相比全连接节省了参数，可以使网络更容易学习和收敛。</p>
<h3 id="聚类得到先验框"><a href="#聚类得到先验框" class="headerlink" title="聚类得到先验框"></a>聚类得到先验框</h3><p>引入anchor后的问题1：怎么确定先验框的尺寸和比例？<br><img src="https://xinhaojin.github.io/imgs-host/20221010/21.png"></p>
<p>把训练集的标注框进行kmeans聚类，k&#x3D;5。距离的定义是D&#x3D;1-IOU。避免了大的框误差就大的情况。</p>
<h3 id="直接位置预测"><a href="#直接位置预测" class="headerlink" title="直接位置预测"></a>直接位置预测</h3><p>引入anchor后的问题2：直接使用anchor进行预测时发现，在训练模型的时候训练不稳定。通过观察发现训练初始阶段不稳定因素来自中心坐标的预测部分导致，所以yolov2规定了中心点不能乱飘出格子。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/22.png"></p>
<h3 id="多尺度训练"><a href="#多尺度训练" class="headerlink" title="多尺度训练"></a>多尺度训练</h3><p>实际图片尺寸多变，不可能都resize成416*416。每训练10批次，就随机改变一次图像尺寸，最小320，最大608。使网络能够适应不同输入尺寸的图片。</p>
<h3 id="特征图融合"><a href="#特征图融合" class="headerlink" title="特征图融合"></a>特征图融合</h3><p>在网络中，前段256<em>256的特征图适合预测小目标，后段13</em>13的特征图适合预测大目标，因为感受野不同。</p>
<p><strong>感受野</strong>：特征图上的一个点能看到原始图像上多大的区域。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/23.png"><br>最后一层的感受野太大了，容易丢失小目标，所以需要融合之前的特征层，reshape后叠加。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/24.png"></p>
<h3 id="网络结构-1"><a href="#网络结构-1" class="headerlink" title="网络结构"></a>网络结构</h3><p>采用了Darknet19网络结构，实际的size和图不一样。<br>输入416<em>416</em>3,输出13<em>13</em>1024<br><img src="https://xinhaojin.github.io/imgs-host/20221010/25.png"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>YOLOv2对YOLOv1的缺陷进行优化，大幅度高了检测的性能，但仍存在一定的问题，如无法解决重叠问题的分类等。</p>
<h2 id="YOLOv3"><a href="#YOLOv3" class="headerlink" title="YOLOv3"></a>YOLOv3</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1804.02767">paper(CVPR2018)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov3">code</a><br><img src="https://xinhaojin.github.io/imgs-host/20221010/26.png"></p>
<h3 id="网络结构-2"><a href="#网络结构-2" class="headerlink" title="网络结构"></a>网络结构</h3><p>主干网络:全卷积网络DarkNet-53，53层卷积层。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/28.png"></p>
<h4 id="残差连接"><a href="#残差连接" class="headerlink" title="残差连接"></a>残差连接</h4><p>Resnet思想：传统的卷积网络或者全连接网络在信息传递的时候或多或少会存在信息丢失，损耗等问题，同时还有导致梯度消失或者梯度爆炸，导致很深的网络无法训练。Resnet在网络中增加了直连通道，允许原始输入信息直接传到后面的层中，看图非常明显，也就是如果后面的层性能不好，可以忽略。</p>
<p><img src="https://xinhaojin.github.io/imgs-host/20221010/27.png"></p>
<h3 id="多scale特征融合"><a href="#多scale特征融合" class="headerlink" title="多scale特征融合"></a>多scale特征融合</h3><p>随着卷积网络的不断深入，深层卷积得到的特征图语义信息越抽象，从而使小目标的特征信息容易丢失。YOLOv3借鉴特征金字塔网络结构（FPN，feature pyramid networks）实行多尺度检测的方法。将416×416尺寸的图像输入YOLOv3算法中，经过5次下采样后得到13×13、26×26和52×52尺寸的特征图，首先将13×13尺寸的特征图二倍上采样后与26×26尺寸的特征图融合，获得包含浅层特征信息和深层特征信息的特征图，然后将特征图再次二倍上采样与52×52尺寸的特征图融合，最后分别在13×13、26×26和52×52尺寸的特征图上进行目标检测。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/29.png"></p>
<h3 id="先验框更丰富"><a href="#先验框更丰富" class="headerlink" title="先验框更丰富"></a>先验框更丰富</h3><p><img src="https://xinhaojin.github.io/imgs-host/20221010/30.png"><br>训练集真实框做kmeans聚类,k&#x3D;9,按大小再分三类，用不同的特征图预测。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/31.png"></p>
<h3 id="预测多标签任务"><a href="#预测多标签任务" class="headerlink" title="预测多标签任务"></a>预测多标签任务</h3><p>一个目标同时属于多个类别，如：动物，狗，哈士奇。在单标签预测的时候，损失函数只和正确类别的概率值有关，而不关心属于其他类别的概率。多标签预测时，相当于将一个多标签问题转化为了在每个标签上的二分类问题,计算一个样本各个标签的损失，然后取平均值，得到最后的损失。</p>
<h2 id="YOLOv4"><a href="#YOLOv4" class="headerlink" title="YOLOv4"></a>YOLOv4</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2004.10934">paper(CVPR2020)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Tianxiaomo/pytorch-YOLOv4">code</a></p>
<p>现阶段的目标检测算法中有三个组件：Backbone、Neck和Head，乍一看很让人不理解：</p>
<p>Backbone, 译作骨干网络，主要指用于特征提取的，已在大型数据集(例如ImageNet|COCO等)上完成预训练，拥有预训练参数的卷积神经网络，例如：ResNet-50、Darknet53等</p>
<p>Head，译作检测头，主要用于预测目标的种类和位置(bounding boxes)<br>在Backone和Head之间，会添加一些用于收集不同阶段中特征图的网络层，通常称为Neck。</p>
<p>输入-&gt;主干-&gt;脖子-&gt;头-&gt;输出。主干网络提取特征，脖子提取一些更复杂的特征，然后头部计算预测输出</p>
<h3 id="网络结构-3"><a href="#网络结构-3" class="headerlink" title="网络结构"></a>网络结构</h3><p>通过对比多种方法和技巧，YOLOv4最终选用CSPDarknet53作为backbone，选用SPP+PAN作为Neck，选用YOLOv3-head作为Head。</p>
<h3 id="Bag-of-freebies"><a href="#Bag-of-freebies" class="headerlink" title="Bag of freebies"></a>Bag of freebies</h3><p>将只改变训练策略或只增加训练成本，而不增加推理成本的方法称为“bag of freebies”(BoF)。BoF中包含的方法有数据增强、正则化函数、标签细化网络、框回归函数等。从BoF中挑选保留的方法有，用于Backbone的CutMix、Mosaic数据增强、DropBlock正则化、Class label smoothing；用于检测器中的CIoU-loss、CmBN、DropBlock正则化、Mosaic数据增强、Self-Adversarial Training、Eliminate grid sensitivity、一个GT使用多个anchors、Cosine annealing scheduler、超参数调优、随机训练图片大小。</p>
<p>Mosaic数据增强，是一种将4张训练图片混合成一张的新数据增强方法，这样可以丰富图像的上下文信息。这种做法的好处是允许检测上下文之外的目标，增强模型的鲁棒性。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/32.png"></p>
<p><img src="https://xinhaojin.github.io/imgs-host/20221010/33.png"></p>
<h3 id="Bag-of-specoals"><a href="#Bag-of-specoals" class="headerlink" title="Bag of specoals"></a>Bag of specoals</h3><p>将那些只会少量增加推理成本，但能显著提高目标检测精度的模块和后处理方法，称之为“bag of specoals”(BoS)。BoS中包含的方法有增强感受野、注意力模块、特征集成、激活函数、后处理等。从BoS中挑选保留的方法有，用于Backbone的Mish激活函数、Cross-stage partial connections (CSP)、Multiinput weighted residual connections (MiWRC)；用于检测器的Mish激活函数、SPP-block、SAM-block、PAN path-aggregation block、DIoU-NMS。</p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>YOLOv4论文中给出了大量的实验结果来证明了其所选择tricks的有效性。</p>
<h2 id="YOLOv5"><a href="#YOLOv5" class="headerlink" title="YOLOv5"></a>YOLOv5</h2><p><a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5">code</a></p>
<h3 id="网络结构-4"><a href="#网络结构-4" class="headerlink" title="网络结构"></a>网络结构</h3><p>Backbone: New CSP-Darknet53</p>
<p>Neck: SPPF, New CSP-PAN</p>
<p>Head : YOLOv3 Head</p>
<h4 id="SPP"><a href="#SPP" class="headerlink" title="SPP"></a>SPP</h4><p>背景：卷积神经网络中经常看到固定输入的设计，但如果我们的输入是不能固定的尺寸怎么办？<br>SPP：空间金字塔池化，能将任意大小的特征图转换成固定大小的特征向量。<br>eg:</p>
<p>输入层：首先我们现在有一张任意大小的图片，其大小为w * h。</p>
<p>输出层：21个神经元 – 即我们待会希望提取到21个特征。</p>
<p>分析如下图所示：分别对1 * 1分块，2 * 2分块和4 * 4子图里分别取每一个框内的max值（即取蓝框框内的最大值），这一步就是作最大池化，这样最后提取出来的特征值（即取出来的最大值）一共有1 * 1 + 2 * 2 + 4 * 4 &#x3D; 21个。得出的特征再concat在一起。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/34.png"></p>
<h4 id="SPPF"><a href="#SPPF" class="headerlink" title="SPPF"></a>SPPF</h4><p>SPPF串联使用了池化层，使得计算效率更高。<br>将两个5×5的池化层进行串联等价于使用一个9×9的最大池化，而使用3个5×5的最大池化又等价于一个13×13的最大池化。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/35.png"></p>
<h3 id="数据增强策略"><a href="#数据增强策略" class="headerlink" title="数据增强策略"></a>数据增强策略</h3><p>Mosaic（图像拼接）<br><code>&lt;br&gt;</code>Copy paste（将不同图像中的目标进行负值和粘贴）<br><code>&lt;br&gt;</code>Random affine（随机仿射变换：旋转、平移等）<br><code>&lt;br&gt;</code>MixUp（将两张图片按一定透明程度混合成一张图片）<br><code>&lt;br&gt;</code>Albumentations（滤波、直方图均衡化以及改变图片质量等等）<br><code>&lt;br&gt;</code>Augment HSV（调整图像色度、透明度和饱和度）<br><code>&lt;br&gt;</code>Random horizontal flip（水平翻转）</p>
<h3 id="训练策略"><a href="#训练策略" class="headerlink" title="训练策略"></a>训练策略</h3><p>Multi-scale training(0.5~1.5x)（多尺度训练）<br><code>&lt;br&gt;</code>AutoAnchor(For training custom data)（重新生成anchor）<br><code>&lt;br&gt;</code>Warmup and Cosine LR scheduler（学习率的调整）<br><code>&lt;br&gt;</code>EMA(Exponential Moving Average)Mixed precision（将学习变量添加一个动量）<br><code>&lt;br&gt;</code>Mixed precision（混合精度训练）<br><code>&lt;br&gt;</code>Evolve hyper-parameters</p>
<h3 id="损失函数-1"><a href="#损失函数-1" class="headerlink" title="损失函数"></a>损失函数</h3><p>Classes loss，分类损失，采用的是BCE loss（二值交叉熵损失），注意只计算正样本的分类损失。<br><code>&lt;br&gt;</code>objectness loss，obj损失，采用的依然是BCE loss，注意这里的obj指的是网络预测的目标边界框与GT<br>Box的CIoU。这里计算的是所有样本的obj损失。<br><code>&lt;br&gt;</code>Location loss，定位损失，采用的是CIoU loss，注意只计算正样本的定位损失。</p>
<h2 id="YOLOX"><a href="#YOLOX" class="headerlink" title="YOLOX"></a>YOLOX</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2107.08430">paper(CVPR2021)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Megvii-BaseDetection/YOLOX">code</a></p>
<p>与yolov5的对比<br><img src="https://xinhaojin.github.io/imgs-host/20221010/36.png"></p>
<h3 id="decoupled-head"><a href="#decoupled-head" class="headerlink" title="decoupled head"></a>decoupled head</h3><p>YOLOX和YOLOv5在网络结构上的主要的差别就在检测头head部分。之前的检测头就是通过一个卷积核大小为1x1的卷积层实现的，即这个卷积层要同时预测类别分数、边界框回归参数以及IOU，这种方式在文章中称之为coupled detection head（耦合的检测头）。作者说采用coupled detection head是对网络有害的，如果将coupled detection head换成decoupled detection head（解耦的检测头）能够大幅提升网络的收敛速度。在论文的图3中展示了YOLO v3分别使用coupled detection head和decoupled detection head的训练收敛情况，明显采用decoupled detection head后收敛速度会更快（在论文的表2中显示采用decoupled detection head能够提升AP约1.1个点）。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/37.png"><br>到底什么是解耦的检测头？根据原论文的图2以及源码绘制的decoupled detection head结构如下。在decoupled detection head中对于预测Cls、Reg以及IoU参数分别使用三个不同的分支，这样就将三者进行了解耦。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/38.png"></p>
<h3 id="anchor-free"><a href="#anchor-free" class="headerlink" title="anchor-free"></a>anchor-free</h3><p>目前行业内，主要有Anchor Based和Anchor Free两种方式。</p>
<p>在Yolov3、Yolov4、Yolov5中，通常都是采用Anchor Based的方式，来提取目标框，进而和标注的groundtruth进行比对，判断两者的差距。</p>
<p><strong>缺点</strong></p>
<p>1).anchor会引入很多需要优化的超参数， 比如anchor number、anchor size、anchor ratio。</p>
<p>2).因为anchor的大小、比例、数量都是提前确定的，会影响模型的泛化性能。对于新的检测任务，需要重新设计anchor的各种参数。<br>为了保证high recall rate，需要大量密集分布的anchor boxes，会导致训练阶段正负样本不均衡的问题。</p>
<p>3).因为anchor boxes数量特别多，训练阶段需要计算所有anchor boxes和ground-truth boxes的IOU，导致特别大的计算量和内存（显存）占用。<br><strong>Anchor Based方式</strong></p>
<p>比如输入图像，经过Backbone、Neck层，最终将特征信息，传送到输出的Feature Map中。</p>
<p>这时，就要设置一些Anchor规则，将预测框和标注框进行关联。从而在训练中，计算两者的差距，即损失函数，再更新网络参数。</p>
<p>比如在下图的，最后的三个Feature Map上，基于每个单元格，都有三个不同尺寸大小的锚框。当输入为416<em>416时，网络最后的三个特征图大小分别为13</em>13，26<em>26，52</em>52。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/40.png"></p>
<p>我们可以看到，黄色框为小狗的Groundtruth，即标注框（真值）。</p>
<p>而蓝色的框，为小狗中心点所在的单元格（红框），所对应的锚框，每个单元格都有3个蓝框。</p>
<p>当采用COCO数据集，即有80个类别时。</p>
<p>基于每个锚框，都有x、y、w、h、obj（前景背景）、class（80个类别），共85个参数。</p>
<p>因此会产生3*(13<em>13+26</em>26+52*52）*85&#x3D;904995个预测结果。</p>
<p>如果将输入从416<em>416，变为640</em>640，最后的三个特征图大小为20<em>20,40</em>40,80*80。</p>
<p>则会产生3*（20<em>20+40</em>40+80*80）*85&#x3D;2142000个预测结果。</p>
<p><strong>Anchor Free方式</strong><br>在前面Anchor Based中，每个Feature map的单元格，都有3个大小不一的锚框。</p>
<p>那么Yolox-Darknet53就没有吗？</p>
<p>其实并不然，这里只是巧妙地将前面Backbone中，下采样的大小信息引入进来。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/41.png"><br>比如上图中，最上面的分支，下采样了5次，2的5次方为32。</p>
<p>并且Decoupled Head的输出，为20<em>20</em>85大小。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/42.png"><br>因此如上图所示：</p>
<p>最后8400个预测框中，其中有400个框(20*20)，所对应锚框的大小，为32 * 32。</p>
<p>同样的原理，中间的分支，最后有1600个预测框(40*40)，所对应锚框的大小，为16 * 16。</p>
<p>最下面的分支，最后有6400个预测框(80*80)，所对应锚框的大小，为8 * 8。</p>
<p>当有了8400个预测框的信息，每张图片也有标注的目标框的信息。<br>下一步需要做的，就是将8400个锚框，和图片上所有的目标框进行关联，挑选出正样本锚框。</p>
<h3 id="标签分配"><a href="#标签分配" class="headerlink" title="标签分配"></a>标签分配</h3><p>当有了8400个Anchor锚框后，这里的每一个锚框，都对应85*8400特征向量中的预测框信息。</p>
<p>不过需要知道，这些预测框只有少部分是正样本，绝大多数是负样本。</p>
<p>那么到底哪些才是正样本呢？</p>
<p>这里需要利用锚框和实际目标框的关系，先挑选出一部分适合的正样本锚框。</p>
<p>比如第3、10、15个锚框是正样本锚框，则对应到网络输出的8400个预测框中，第3、10、15个预测框，就是相应的正样本预测框。</p>
<p>训练过程中，在锚框的基础上，不断的预测，然后不断的迭代，从而更新网络参数，让网络损失越来越小，预测的越来越准。</p>
<p>那么在Yolox中，是如何挑选正样本锚框的呢？</p>
<p>这里就涉及到两个关键点：初步筛选、SimOTA。</p>
<h4 id="初步筛选"><a href="#初步筛选" class="headerlink" title="初步筛选"></a>初步筛选</h4><p>1.中心点在真实框内的锚框</p>
<p>2.已真实框中心点为基准，设置边长为5的正方形，挑选在正方形内的所有锚框</p>
<h4 id="SimOTA"><a href="#SimOTA" class="headerlink" title="SimOTA"></a>SimOTA</h4><p><img src="https://xinhaojin.github.io/imgs-host/20221010/43.png"><br>SimOTA可以理解为是一种匹配策略的方法，可以看成是一个最优传输的问题。举一个通俗易懂的例子就是，有2个分配基地与6个周围城市，现在需要考虑一个最优的配送方式来确保分配东西到这几个城市的运输成本是最低的。而对于目标检测来说，这个最优传输问题也就是一个最优分配问题，如何实现把这些anchor point分配给groundtruth的代价（cost）是最低的。这个代价就是iou损失，分类损失等内容。<br>(yolox的核心，但没看懂)</p>
<h2 id="YOLOv7"><a href="#YOLOv7" class="headerlink" title="YOLOv7"></a>YOLOv7</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2207.02696">paper(CVPR2022)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/WongKinYiu/yolov7">code</a></p>
<p>本文的贡献总结如下：</p>
<p>1.设计了几种可训练的bag-of-freebies 方法，使得实时目标检测可以在不增加推理成本的情况下大大提高检测精度；</p>
<p>2.对于目标检测方法的发展，本文发现了两个新问题，即重参数化模块。如何替换原始模块，以及动态标签分配策略，如何处理对不同输出层的分配。此外，本文还提出了解决这些问题的方法；</p>
<p>3.本文提出了实时目标检测器的extend和compound scaling复合缩放 方法，可以有效地利用参数和计算；</p>
<p>4.本文提出的方法可以有效地减少目前最优秀的实时目标检测器的大约40%的参数和50%的计算，并且具有更快的推理速度和更高的检测精度。</p>
<h3 id="模型重参数化方法-GoogLeNet-Snapshot-ensembles"><a href="#模型重参数化方法-GoogLeNet-Snapshot-ensembles" class="headerlink" title="模型重参数化方法(GoogLeNet,Snapshot ensembles)"></a>模型重参数化方法(GoogLeNet,Snapshot ensembles)</h3><p>在推理阶段将多个计算模块合并为一个。模型重参数化技术可以被视为一种集成技术，可以将其分为两类，即模块级集成和模型级集成。有两种用于模型级重参数化以获得最终推理模型的常见用法：一种是用不同的训练数据训练多个相同的模型，然后对多个训练模型的权重进行平均。另一种方法是对不同迭代次数下的模型权重进行加权平均。</p>
<p>模块级重参数化是最近比较流行的研究问题。这种类型的方法在训练期间将模块拆分为多个相同或不同的模块分支，并在推理期间将多个分支模块集成为完全等效的模块。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/46.png"></p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>本文提出了一种新的实时目标检测器体系结构 和 相应的模型缩放方法。此外还发现，目标检测方法的发展过程产生了新的研究课题。在研究过程中，发现了 重参数化模块的替换问题和动态标签分配的分配问题。为了解决这个问题，本文提出了一种可训练的bag-of-freebies ，以提高目标检测的准确性。在此基础上，开发了YOLOv7系列目标检测系统 ，该系统获得了最优秀的结果。</p>
<h2 id="YOLOv6"><a href="#YOLOv6" class="headerlink" title="YOLOv6"></a>YOLOv6</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2209.02976">paper(CVPR2022)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/meituan/YOLOv6">code</a></p>
<p>YOLOv6 是美团视觉智能部研发的一款目标检测框架，致力于工业应用。本框架同时专注于检测的精度和推理效率，在工业界常用的尺寸模型中：YOLOv6-nano 在 COCO 上精度可达 35.0% AP，在 T4 上推理速度可达 1242 FPS；YOLOv6-s 在 COCO 上精度可达 43.1% AP，在 T4 上推理速度可达 520 FPS。在部署方面，YOLOv6 支持 GPU（TensorRT）、CPU（OPENVINO）、ARM（MNN、TNN、NCNN）等不同平台的部署，极大地简化工程部署时的适配工作。<br><img src="https://xinhaojin.github.io/imgs-host/20221010/45.png"></p>
<h3 id="现有YOLO的问题"><a href="#现有YOLO的问题" class="headerlink" title="现有YOLO的问题"></a>现有YOLO的问题</h3><p>根据经验分析以往YOLO系列及最新算法，观察到了几个重要因素，这些因素促使重新完善YOLO框架：</p>
<p>1.RepVGG的重参数化算法是一种优越的技术，尚未在检测中得到充分利用。而且，RepVGG Block的模型缩放不切实际，本文认为小型和大型网络之间的网络设计保持一致是不必要的。普通单路径架构对于小型网络是更好的选择，但是对于更大的模型，参数的指数增长和单路径架构的计算成本使其不可行；</p>
<p>2.基于重参数化的检测器的量化也需要细致的处理，否则，由于其在训练和推理期间的不同处理，很难处理性能退化的问题。</p>
<p>3.以前的算法[YOLOX，YOLOv5，YOLOv7，PP-YOLOE]较少 关注部署，其延迟通常在高成本机器（如V100）上进行比较。在实际服务环境中，存在硬件差距。</p>
<p>4.先进的特定策略，如 标签分配和 损失函数设计，考虑到架构差异，需要进一步验证使用；</p>
<p>5.对于部署，可以对训练策略进行调整，以提高准确性性能，但不增加推理成本，如知识蒸馏。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>通过对以上问题的分析，提出了YOLOv6，在精度和速度方面实现了迄今为止最好的折衷。另外为了提高推理速度而不使性能有有太多退化，研究了最前沿的量化方法，包括 训练后量化（post-training quantization,PTQ）和 量化感知训练（quantization-aware training,QAT），并将其整合在YOLOv6中。<br>YOLOv6的关键点总结如下：</p>
<p>1.为不同场景中的工业应用量身定制了一系列不同规模的网络。不同规模的架构各不相同，以实现最佳的速度和精度权衡，其中小型模型采用简单的单路径backbone，大型模型构建在高效的多分支块上。</p>
<p>2.为YOLOv6在分类任务和回归任务中都加入了自蒸馏策略。同时，动态调整来自teacher和标签的信息，以帮助student模型能在所有训练阶段更有效地学习知识。</p>
<p>3.广泛验证了比较先进的技术，例如 标签分配、损失函数和数据增强技术等，并 有选择地采用它们以进一步提高性能。</p>
<p>4.在 RepOptimizer优化器和通道蒸馏的帮助下，对检测任务的量化方案进行了改革，得到了一个具有43.3%COCOAP和869FPS吞吐量的快速准确检测器(batchsize为32)。</p>
<h3 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a>结论</h3><p>简而言之，考虑到持续的工业需求，提出了YOLOv6，仔细分析了迄今为止目标检测器组件的所有进步。结果在精度和速度上都超过了其他可用的实时目标检测器。为了便于工业部署，还为YOLOv6提供了一种定制的量化方法，从而提供了前所未有的快速检测器。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gS4y1w79N">https://www.bilibili.com/video/BV1gS4y1w79N</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45848575/article/details/125438818">https://blog.csdn.net/weixin_45848575/article/details/125438818</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/014e76d3b614">https://www.jianshu.com/p/014e76d3b614</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39707285/category_12009356.html">https://blog.csdn.net/qq_39707285/category_12009356.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38688399/article/details/106692156">https://blog.csdn.net/weixin_38688399/article/details/106692156</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_55073640/article/details/122621148">https://blog.csdn.net/weixin_55073640/article/details/122621148</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37541097/article/details/125132817">https://blog.csdn.net/qq_37541097/article/details/125132817</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rh8866/article/details/123775117">https://blog.csdn.net/rh8866/article/details/123775117</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/10/08/yolo%E7%B3%BB%E5%88%97%E7%BB%BC%E8%BF%B0(v1-v7)/" data-id="cm9zmq8zh00clsqhl56cq3f33" data-title="yolo主流版本介绍(v1-v7)" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-windows命令行cmd代理设置（结合v2rayn）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/09/22/windows%E5%91%BD%E4%BB%A4%E8%A1%8Ccmd%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%EF%BC%88%E7%BB%93%E5%90%88v2rayn%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2022-09-22T04:03:28.000Z" itemprop="datePublished">2022-09-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/09/22/windows%E5%91%BD%E4%BB%A4%E8%A1%8Ccmd%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%EF%BC%88%E7%BB%93%E5%90%88v2rayn%EF%BC%89/">windows命令行cmd代理设置（结合v2rayn）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="v2rayn代理端口"><a href="#v2rayn代理端口" class="headerlink" title="v2rayn代理端口"></a>v2rayn代理端口</h2><pre><code>socks5:127.0.0.1:10808
http:127.0.0.1:10809
</code></pre>
<h2 id="cmd临时代理（对当前cmd生效）"><a href="#cmd临时代理（对当前cmd生效）" class="headerlink" title="cmd临时代理（对当前cmd生效）"></a>cmd临时代理（对当前cmd生效）</h2><pre><code>set http_proxy=http://127.0.0.1:10809
set https_proxy=http://127.0.0.1:10809

set http_proxy=socks5://127.0.0.1:10808
set https_proxy=socks5://127.0.0.1:10808
</code></pre>
<h2 id="cmd永久代理"><a href="#cmd永久代理" class="headerlink" title="cmd永久代理"></a>cmd永久代理</h2><pre><code>netsh winhttp import proxy source=ie
</code></pre>
<h3 id="打开前后的对比"><a href="#打开前后的对比" class="headerlink" title="打开前后的对比"></a>打开前后的对比</h3><p><img src="https://xinhaojin.github.io/imgs-host/past/2022/09/image-7.png"></p>
<h3 id="测试代理"><a href="#测试代理" class="headerlink" title="测试代理"></a>测试代理</h3><pre><code>curl www.google.com
</code></pre>
<h3 id="控制代理开关，清除系统代理：关，自动配置系统代理：开。"><a href="#控制代理开关，清除系统代理：关，自动配置系统代理：开。" class="headerlink" title="控制代理开关，清除系统代理：关，自动配置系统代理：开。"></a>控制代理开关，清除系统代理：关，自动配置系统代理：开。</h3><p><img src="https://xinhaojin.github.io/imgs-host/past/2022/09/image-6.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/09/22/windows%E5%91%BD%E4%BB%A4%E8%A1%8Ccmd%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%EF%BC%88%E7%BB%93%E5%90%88v2rayn%EF%BC%89/" data-id="cm9zmq8z500azsqhl3lc0ejj4" data-title="windows命令行cmd代理设置（结合v2rayn）" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" rel="tag">软件安装配置</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/LeetCode/">LeetCode</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/%E6%9D%82/">杂</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/python/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/%E6%9D%82/">杂</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/">pytorch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E5%B7%A5/">网工</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/linux/">linux</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDN/" rel="tag">CDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDNS/" rel="tag">DDNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DHCP/" rel="tag">DHCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/" rel="tag">DNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IP/" rel="tag">IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPsec/" rel="tag">IPsec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LDA/" rel="tag">LDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFC/" rel="tag">NFC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PDF/" rel="tag">PDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMTP/" rel="tag">SMTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chatgpt/" rel="tag">chatgpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudflare/" rel="tag">cloudflare</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ocr/" rel="tag">ocr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyinstaller/" rel="tag">pyinstaller</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpa/" rel="tag">rpa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/" rel="tag">wget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wol/" rel="tag">wol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wordpress/" rel="tag">wordpress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/worldcloud/" rel="tag">worldcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="tag">二叉树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E7%9B%98/" rel="tag">云盘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B/" rel="tag">人脸检测</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE/" rel="tag">倍速播放</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">内网穿透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%9B%AE%E6%91%84%E5%83%8F%E5%A4%B4%E6%B5%8B%E8%B7%9D/" rel="tag">单目摄像头测距</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%88%E5%A4%AB%E6%9B%BC/" rel="tag">哈夫曼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" rel="tag">哈希表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag">图像处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D/" rel="tag">域名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A0%86/" rel="tag">堆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" rel="tag">多屏协同</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%AA%E7%94%9F%E7%BD%91%E7%BB%9C/" rel="tag">孪生网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/" rel="tag">局域网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" rel="tag">数据集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BF%80%E5%85%89%E6%B5%8B%E8%B7%9D/" rel="tag">激光测距</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%82%B9%E9%80%89%E9%AA%8C%E8%AF%81%E7%A0%81/" rel="tag">点选验证码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" rel="tag">端口转发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E5%B7%A5/" rel="tag">网工</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%81%E6%AF%9B%E5%AD%90%E5%9B%BA%E4%BB%B6/" rel="tag">老毛子固件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/" rel="tag">视频下载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" rel="tag">视频流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97/" rel="tag">语音转文字</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E5%83%8F%E7%B4%A0/" rel="tag">超像素</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E5%A3%B0%E6%B3%A2/" rel="tag">超声波</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BA/" rel="tag">路由器刷机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" rel="tag">软件安装配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">链表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9F%B3%E7%94%BB%E5%90%8C%E6%AD%A5/" rel="tag">音画同步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/" rel="tag">验证码</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/DDNS/" style="font-size: 10px;">DDNS</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/HTTP/" style="font-size: 10.67px;">HTTP</a> <a href="/tags/IP/" style="font-size: 10.67px;">IP</a> <a href="/tags/IPsec/" style="font-size: 10px;">IPsec</a> <a href="/tags/LDA/" style="font-size: 10px;">LDA</a> <a href="/tags/NFC/" style="font-size: 10px;">NFC</a> <a href="/tags/PDF/" style="font-size: 10px;">PDF</a> <a href="/tags/SMTP/" style="font-size: 10px;">SMTP</a> <a href="/tags/blog/" style="font-size: 11.33px;">blog</a> <a href="/tags/c/" style="font-size: 16px;">c++</a> <a href="/tags/chatgpt/" style="font-size: 10.67px;">chatgpt</a> <a href="/tags/cloudflare/" style="font-size: 11.33px;">cloudflare</a> <a href="/tags/docker/" style="font-size: 12.67px;">docker</a> <a href="/tags/flask/" style="font-size: 11.33px;">flask</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/js/" style="font-size: 11.33px;">js</a> <a href="/tags/linux/" style="font-size: 19.33px;">linux</a> <a href="/tags/nginx/" style="font-size: 12.67px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/ocr/" style="font-size: 10px;">ocr</a> <a href="/tags/php/" style="font-size: 10.67px;">php</a> <a href="/tags/pyinstaller/" style="font-size: 10px;">pyinstaller</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pytorch/" style="font-size: 16.67px;">pytorch</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rpa/" style="font-size: 10px;">rpa</a> <a href="/tags/selenium/" style="font-size: 11.33px;">selenium</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/ssh/" style="font-size: 13.33px;">ssh</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wol/" style="font-size: 10px;">wol</a> <a href="/tags/wordpress/" style="font-size: 10.67px;">wordpress</a> <a href="/tags/worldcloud/" style="font-size: 10px;">worldcloud</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 12.67px;">二叉树</a> <a href="/tags/%E4%BA%91%E7%9B%98/" style="font-size: 10px;">云盘</a> <a href="/tags/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B/" style="font-size: 10px;">人脸检测</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 13.33px;">代理</a> <a href="/tags/%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE/" style="font-size: 10px;">倍速播放</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 11.33px;">内网穿透</a> <a href="/tags/%E5%8D%95%E7%9B%AE%E6%91%84%E5%83%8F%E5%A4%B4%E6%B5%8B%E8%B7%9D/" style="font-size: 10px;">单目摄像头测距</a> <a href="/tags/%E5%93%88%E5%A4%AB%E6%9B%BC/" style="font-size: 10px;">哈夫曼</a> <a href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" style="font-size: 10.67px;">哈希表</a> <a href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 14px;">图像处理</a> <a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 10px;">域名</a> <a href="/tags/%E5%A0%86/" style="font-size: 10px;">堆</a> <a href="/tags/%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" style="font-size: 10px;">多屏协同</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E5%AD%AA%E7%94%9F%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">孪生网络</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 13.33px;">安卓</a> <a href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/" style="font-size: 12px;">局域网</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 18.67px;">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" style="font-size: 15.33px;">数据集</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size: 10px;">数组</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 14.67px;">树莓派</a> <a href="/tags/%E6%BF%80%E5%85%89%E6%B5%8B%E8%B7%9D/" style="font-size: 10px;">激光测距</a> <a href="/tags/%E7%82%B9%E9%80%89%E9%AA%8C%E8%AF%81%E7%A0%81/" style="font-size: 10px;">点选验证码</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 13.33px;">爬虫</a> <a href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" style="font-size: 18px;">目标检测</a> <a href="/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" style="font-size: 10px;">端口转发</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 11.33px;">编译原理</a> <a href="/tags/%E7%BD%91%E5%B7%A5/" style="font-size: 14px;">网工</a> <a href="/tags/%E8%80%81%E6%AF%9B%E5%AD%90%E5%9B%BA%E4%BB%B6/" style="font-size: 10px;">老毛子固件</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 10px;">虚拟机</a> <a href="/tags/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/" style="font-size: 10.67px;">视频下载</a> <a href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" style="font-size: 10px;">视频流</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10.67px;">计算机网络</a> <a href="/tags/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97/" style="font-size: 10px;">语音转文字</a> <a href="/tags/%E8%B6%85%E5%83%8F%E7%B4%A0/" style="font-size: 10px;">超像素</a> <a href="/tags/%E8%B6%85%E5%A3%B0%E6%B3%A2/" style="font-size: 10px;">超声波</a> <a href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BA/" style="font-size: 10px;">路由器刷机</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" style="font-size: 17.33px;">软件安装配置</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 10.67px;">递归</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 11.33px;">链表</a> <a href="/tags/%E9%9F%B3%E7%94%BB%E5%90%8C%E6%AD%A5/" style="font-size: 10px;">音画同步</a> <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/" style="font-size: 12.67px;">验证码</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/04/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2025/04/25/ubuntu24%E9%87%8D%E8%A3%85%E8%AE%B0%E5%BD%95/">ubuntu24重装记录</a>
          </li>
        
          <li>
            <a href="/2025/04/01/win11%E6%B7%BB%E5%8A%A0%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E7%BD%91%E5%8D%A1%E5%BC%82%E5%B8%B8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF/">win11添加开机自启动脚本实现网卡异常自动重启</a>
          </li>
        
          <li>
            <a href="/2025/02/06/DBeaver%E8%BF%9E%E6%8E%A5MySQL%E5%92%8CIoTDB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AD%A5%E9%AA%A4/">DBeaver连接MySQL和IoTDB数据库步骤</a>
          </li>
        
          <li>
            <a href="/2025/01/26/%E4%BD%BF%E7%94%A8polkit%E5%AE%9E%E7%8E%B0%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86systemctl%E6%9C%8D%E5%8A%A1/">使用polkit实现普通用户管理systemctl服务</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>