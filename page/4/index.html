<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-添加网卡第二IP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/28/%E6%B7%BB%E5%8A%A0%E7%BD%91%E5%8D%A1%E7%AC%AC%E4%BA%8CIP/" class="article-date">
  <time class="dt-published" datetime="2024-08-28T01:10:00.000Z" itemprop="datePublished">2024-08-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>►<a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/28/%E6%B7%BB%E5%8A%A0%E7%BD%91%E5%8D%A1%E7%AC%AC%E4%BA%8CIP/">添加网卡第二IP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>当需要同时ping通两个网段的IP时，如果没有第二张可用网卡，那么也可以添加网卡的第二个IP地址。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>添加第二个IP的命令是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh interface ip add address &quot;&#123;interface_name&#125;&quot; &#123;ip_address&#125;</span><br><span class="line"> &#123;subnet_mask&#125;</span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface ip add address &quot;以太网&quot; 192.168.1.100 255.255.255.0</span><br></pre></td></tr></table></figure>

<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> ipaddress</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EthernetManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.interface_name = <span class="variable language_">self</span>.get_adapter_names()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_adapter_names</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取主要的以太网适配器名称&quot;&quot;&quot;</span></span><br><span class="line">        result = os.popen(<span class="string">&#x27;ipconfig&#x27;</span>)</span><br><span class="line">        res = result.read().strip()</span><br><span class="line">        adapter_list = re.findall(</span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;(?&lt;=以太网适配器 ).*?(?=:)|(?&lt;=无线局域网适配器 ).*?(?=:)&#x27;&#x27;&#x27;</span>, res)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">sort_key</span>(<span class="params">adapter_name</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;以太网&#x27;</span> <span class="keyword">in</span> adapter_name:</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">0</span>, adapter_name)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&#x27;Ethernet&#x27;</span> <span class="keyword">in</span> adapter_name:</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">1</span>, adapter_name)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&#x27;eht&#x27;</span> <span class="keyword">in</span> adapter_name:</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">2</span>, adapter_name)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&#x27;本地连接&#x27;</span> <span class="keyword">in</span> adapter_name:</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">3</span>, adapter_name)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">4</span>, adapter_name)</span><br><span class="line"></span><br><span class="line">        sorted_adapters = <span class="built_in">sorted</span>(adapter_list, key=sort_key)</span><br><span class="line">        <span class="keyword">return</span> sorted_adapters</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_ips</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取当前适配器的所有IP地址&quot;&quot;&quot;</span></span><br><span class="line">        command = <span class="string">&#x27;ipconfig&#x27;</span></span><br><span class="line">        result = subprocess.run(command, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, shell=<span class="literal">True</span>)</span><br><span class="line">        output = result.stdout.strip()</span><br><span class="line">        start = output.find(<span class="string">f&quot;<span class="subst">&#123;self.interface_name&#125;</span>:&quot;</span>)</span><br><span class="line">        end = output.find(<span class="string">&quot;默认网关&quot;</span>, start)</span><br><span class="line">        end = output.find(<span class="string">&quot;\n&quot;</span>, end)</span><br><span class="line">        start = output.find(<span class="string">&quot;IPv4 地址&quot;</span>)</span><br><span class="line">        result = output[start:end].strip()</span><br><span class="line">        pattern = <span class="string">r&#x27;IPv4.*?((?:\d+\.\d+\.\d+\.\d+))&#x27;</span></span><br><span class="line">        ips = re.findall(pattern, result, re.DOTALL)</span><br><span class="line"></span><br><span class="line">        gateway = result.split(<span class="string">&#x27;:&#x27;</span>)[-<span class="number">1</span>].strip()</span><br><span class="line">        subnet_mask = result.split(<span class="string">&#x27;默认网关&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&#x27;:&#x27;</span>)[-<span class="number">1</span>].strip()</span><br><span class="line">        <span class="comment"># 判断ip地址是否和网关在同一网段</span></span><br><span class="line">        <span class="comment"># 使用子网掩码创建IPv4Network对象</span></span><br><span class="line">        network = ipaddress.ip_network(<span class="string">f&#x27;0.0.0.0/<span class="subst">&#123;subnet_mask&#125;</span>&#x27;</span>, strict=<span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># 获取前缀长度</span></span><br><span class="line">        prefix_length = network.prefixlen</span><br><span class="line">        network = ipaddress.ip_network(<span class="string">f&#x27;<span class="subst">&#123;gateway&#125;</span>/<span class="subst">&#123;prefix_length&#125;</span>&#x27;</span>, strict=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 判断是否在同一网段,排序,在网关网段的IP地址,挪到最后</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">ip_sort</span>(<span class="params">ip</span>):</span><br><span class="line">            <span class="keyword">if</span> ipaddress.ip_address(ip) <span class="keyword">in</span> network:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        ips.sort(key=ip_sort)</span><br><span class="line">        <span class="keyword">return</span> ips</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_ip</span>(<span class="params">self, ip_address</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;移除指定的IP地址&quot;&quot;&quot;</span></span><br><span class="line">        command = <span class="string">f&#x27;netsh interface ip delete address &quot;<span class="subst">&#123;self.interface_name&#125;</span>&quot; <span class="subst">&#123;ip_address&#125;</span>&#x27;</span></span><br><span class="line">        subprocess.run(command, shell=<span class="literal">True</span>, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_ip</span>(<span class="params">self, ip_address, subnet_mask</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加新的IP地址&quot;&quot;&quot;</span></span><br><span class="line">        command = <span class="string">f&#x27;netsh interface ip add address &quot;<span class="subst">&#123;self.interface_name&#125;</span>&quot; <span class="subst">&#123;ip_address&#125;</span> <span class="subst">&#123;subnet_mask&#125;</span>&#x27;</span></span><br><span class="line">        subprocess.run(command, shell=<span class="literal">True</span>, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_extra_ips</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;移除多余的IP地址,只保留最后一个&quot;&quot;&quot;</span></span><br><span class="line">        ips = <span class="variable language_">self</span>.get_ips()</span><br><span class="line">        <span class="keyword">for</span> ip <span class="keyword">in</span> ips[:-<span class="number">1</span>]:  <span class="comment"># 保留最后一个IP</span></span><br><span class="line">            <span class="variable language_">self</span>.remove_ip(ip)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_second_ip</span>(<span class="params">self, new_ip, subnet_mask</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加第二个IP地址:删除多余IP,然后添加新IP&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.remove_extra_ips()</span><br><span class="line">        <span class="variable language_">self</span>.add_ip(new_ip, subnet_mask)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_adapter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;选择以太网适配器&quot;&quot;&quot;</span></span><br><span class="line">        adapter_list = <span class="variable language_">self</span>.get_adapter_names()</span><br><span class="line">        <span class="comment"># 打印适配器列表供用户选择</span></span><br><span class="line">        <span class="keyword">for</span> i, adapter <span class="keyword">in</span> <span class="built_in">enumerate</span>(adapter_list, <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;adapter&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 请求用户输入并验证输入</span></span><br><span class="line">        choice = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> choice <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(adapter_list) + <span class="number">1</span>):</span><br><span class="line">            choice = <span class="built_in">input</span>(<span class="string">&quot;请输入选择的网卡编号 (直接按回车默认选择第一个): &quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> choice == <span class="string">&#x27;&#x27;</span>:  <span class="comment"># 用户直接按回车</span></span><br><span class="line">                choice = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> choice.isdigit() <span class="keyword">and</span> <span class="number">1</span> &lt;= <span class="built_in">int</span>(choice) &lt;= <span class="built_in">len</span>(adapter_list):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;输入错误,请确保输入的是1到&quot;</span>, <span class="built_in">len</span>(adapter_list), <span class="string">&quot;之间的数字&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置em的interface_name属性</span></span><br><span class="line">        <span class="variable language_">self</span>.interface_name = adapter_list[<span class="built_in">int</span>(choice) - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;您选择的网卡为: <span class="subst">&#123;self.interface_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    em = EthernetManager()</span><br><span class="line">    em.select_adapter()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ip=<span class="built_in">input</span>(<span class="string">&quot;请输入要添加的IP地址: &quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ipaddress.ip_address(ip)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;输入的IP地址不合法,请重新输入&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        subnet_mask=<span class="built_in">input</span>(<span class="string">&quot;请输入子网掩码,回车默认255.255.255.0:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> subnet_mask==<span class="string">&quot;&quot;</span>:</span><br><span class="line">            subnet_mask=<span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ipaddress.IPv4Network(<span class="string">f&quot;0.0.0.0/<span class="subst">&#123;subnet_mask&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;输入的子网掩码不合法,请重新输入&quot;</span>)</span><br><span class="line">    em.add_second_ip(ip, subnet_mask)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">in</span> em.get_ips():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;添加成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;添加失败,请以管理员身份运行&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>当需要频繁更换第二IP地址时，可以用此脚本来实现。</p>
<ul>
<li>首先列出所有的网卡，供用户选择</li>
<li>选择网卡后，如果该网卡已经有多个IP，那么只保留一个与默认网关同网段的IP，其余IP地址全部删除</li>
<li>然后输入并添加第二个IP地址</li>
<li>验证是否成功，不成功的原因基本上是因为没有以管理员权限运行</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/28/%E6%B7%BB%E5%8A%A0%E7%BD%91%E5%8D%A1%E7%AC%AC%E4%BA%8CIP/" data-id="cm9zmq90c00gnsqhlh4h100p3" data-title="添加网卡第二IP" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IP/" rel="tag">IP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-IP地址修改器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/27/IP%E5%9C%B0%E5%9D%80%E4%BF%AE%E6%94%B9%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2024-08-27T04:02:30.000Z" itemprop="datePublished">2024-08-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>►<a class="article-category-link" href="/categories/python/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/27/IP%E5%9C%B0%E5%9D%80%E4%BF%AE%E6%94%B9%E5%99%A8/">IP地址修改器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在需要频繁换IP地址的情况下，打开网络设置去修改比较慢，因此设计一个IP地址修改器，可以快速修改IP</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IpManage</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ip_list = <span class="variable language_">self</span>.get_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_ip</span>(<span class="params">self, name, ip, mask, gateway</span>):</span><br><span class="line">        <span class="comment"># 设置静态IP地址</span></span><br><span class="line">        os.system(<span class="string">f&quot;netsh interface ip set address name=\&quot;<span class="subst">&#123;name&#125;</span>\&quot; static <span class="subst">&#123;ip&#125;</span> <span class="subst">&#123;mask&#125;</span> <span class="subst">&#123;gateway&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_dns</span>(<span class="params">self, name, dns_primary, dns_secondary</span>):</span><br><span class="line">        <span class="comment"># 设置DNS服务器地址</span></span><br><span class="line">        os.system(<span class="string">f&quot;netsh interface ip set dnsservers name=\&quot;<span class="subst">&#123;name&#125;</span>\&quot; static addr=<span class="subst">&#123;dns_primary&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> dns_secondary:</span><br><span class="line">            os.system(<span class="string">f&quot;netsh interface ip add dnsservers name=\&quot;<span class="subst">&#123;name&#125;</span>\&quot; addr=<span class="subst">&#123;dns_secondary&#125;</span> index=2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_ip</span>(<span class="params">self</span>):</span><br><span class="line">        result = os.popen(<span class="string">&#x27;ipconfig&#x27;</span>)</span><br><span class="line">        res = result.read().strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用正则表达式查找适配器名称</span></span><br><span class="line">        resultlist = re.findall(<span class="string">&#x27;&#x27;&#x27;(?&lt;=以太网适配器 ).*?(?=:)|(?&lt;=无线局域网适配器 ).*?(?=:)&#x27;&#x27;&#x27;</span>, res)  </span><br><span class="line">        <span class="comment"># print(&quot;可用的网络适配器：&quot;, resultlist)</span></span><br><span class="line">        <span class="keyword">return</span> resultlist</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_adapter_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 让用户选择适配器</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请选择要配置的网络适配器（例如: 以太网）:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i, adapter <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>.ip_list, <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;adapter&#125;</span>&quot;</span>)</span><br><span class="line">        choice = <span class="built_in">input</span>(<span class="string">&quot;请输入选择的适配器编号: &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.ip_list[<span class="built_in">int</span>(choice) - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    im = IpManage()</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 获取用户选择的适配器名称</span></span><br><span class="line">    adapter_name = im.get_adapter_name()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户输入IP配置信息</span></span><br><span class="line">    ip_addr = <span class="built_in">input</span>(<span class="string">&quot;请输入IP地址 (默认: 192.168.31.108): &quot;</span>) <span class="keyword">or</span> <span class="string">&quot;192.168.31.108&quot;</span></span><br><span class="line">    subnet_mask = <span class="built_in">input</span>(<span class="string">&quot;请输入子网掩码 (默认: 255.255.255.0): &quot;</span>) <span class="keyword">or</span> <span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line">    gateway = <span class="built_in">input</span>(<span class="string">&quot;请输入网关地址 (默认: 192.168.31.1): &quot;</span>) <span class="keyword">or</span> <span class="string">&quot;192.168.31.1&quot;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 用户输入DNS配置信息</span></span><br><span class="line">    dns_primary = <span class="built_in">input</span>(<span class="string">&quot;请输入首选DNS服务器地址 (默认: 192.168.31.1): &quot;</span>) <span class="keyword">or</span> <span class="string">&quot;192.168.31.1&quot;</span></span><br><span class="line">    dns_secondary = <span class="built_in">input</span>(<span class="string">&quot;请输入备用DNS服务器地址 (默认: 留空可不设置): &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置IP和DNS</span></span><br><span class="line">    im.set_ip(adapter_name, ip_addr, subnet_mask, gateway)</span><br><span class="line">    im.set_dns(adapter_name, dns_primary, dns_secondary)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;IP和DNS设置成功&quot;</span>)</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">&quot;按任意键退出...&quot;</span>)</span><br><span class="line">    <span class="comment"># pyinstaller --onefile ip.py</span></span><br></pre></td></tr></table></figure>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="https://xinhaojin.github.io/imgs-host/20240827/1724732053037.jpg"><br>也可以使用pyinstaller将代码打包成exe文件，方便使用。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyinstaller --onefile ip.py</span><br></pre></td></tr></table></figure>

<p>生成的exe文件在dist目录下。</p>
<p>如果有几个固定的IP需要修改，可以分别写成几个exe文件，这样只要用管理员权限运行exe文件即可快速修改！</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>必须以管理员权限运行才能修改IP地址，否则即使没有提示权限不足也无法真正修改IP地址。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/27/IP%E5%9C%B0%E5%9D%80%E4%BF%AE%E6%94%B9%E5%99%A8/" data-id="cm9zmq8wu000gsqhl01hmgjc0" data-title="IP地址修改器" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IP/" rel="tag">IP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-处理非标准http响应" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/01/%E5%A4%84%E7%90%86%E9%9D%9E%E6%A0%87%E5%87%86http%E5%93%8D%E5%BA%94/" class="article-date">
  <time class="dt-published" datetime="2024-08-01T09:18:09.000Z" itemprop="datePublished">2024-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/01/%E5%A4%84%E7%90%86%E9%9D%9E%E6%A0%87%E5%87%86http%E5%93%8D%E5%BA%94/">处理非标准http响应</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>手上有一台温湿度传感器，网线连接，内部有http服务，浏览器直接访问完全没问题，但是使用python的http，request库都报错，使用apipost发现也是错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 发送GET请求</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://192.168.31.188&#x27;</span>)</span><br><span class="line"><span class="comment"># 打印原始响应内容</span></span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConnectionError: (<span class="string">&#x27;Connection aborted.&#x27;</span>, BadStatusLine(<span class="string">&#x27;HTTP/1.1 0 -\r\n&#x27;</span>,))</span><br></pre></td></tr></table></figure>

<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>刚开始以为是请求头之类的问题，但一个小传感器搞复杂的安全策略完全没必要啊，后来通过wireshark抓包发现他的http响应是这样的，里面已经包含了我需要的数据，但是没有办法被正确处理：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>TH<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">style</span>=<span class="string">&quot;width: 960px;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;2&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;250&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-family: Verdana; font-weight: bold; font-style: italic; background-color: rgb(51, 255, 255); text-align: center;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: bold;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">big</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: bold;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>Air Conditioning Controller<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">small</span> <span class="attr">style</span>=<span class="string">&quot;font-family: Verdana;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">big</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: bold;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: rgb(51, 51, 255);&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>Ethernet IP Type<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;menu.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sysconfig&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">style</span>=<span class="string">&quot;width: 960px; &quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;2&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;250&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-family: Verdana; font-weight: bold; font-style: italic; background-color: rgb(51, 255, 255); text-align: center;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Temprature: 26.7 ℃<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Humidity: 42.9 %<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Lastcmd: 0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Device ID: 1482184792<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Bus Addr: 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;checkinSubmit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Click to enter the configuration menu list&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">small</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">class</span>=<span class="string">&quot;footmsg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: silver;&quot;</span>&gt;</span>All Rights Reserved@2023<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是其他网站的http响应，经过对比之后发现规范的http响应应该以HTTP&#x2F;1.1 200 OK开头，这时候再看错误似乎就知道什么意思了，badstatusline不就是状态行错误嘛</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Thu, 01 Aug <span class="number">2024</span> 08:<span class="number">58</span>:<span class="number">32</span> GMT</span><br><span class="line">Content-<span class="type">Type</span>: text/plain; charset=utf-<span class="number">8</span></span><br><span class="line">Content-Length: <span class="number">2417</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line"><span class="type">Set</span>-Cookie: tgw_l7_route=a699e39024d0403234b82455ae41cef1; Expires=Thu, 01-Aug-<span class="number">2024</span> 09:<span class="number">28</span>:<span class="number">32</span> GMT; Path=/</span><br><span class="line"></span><br><span class="line">&lt;sg <span class="built_in">type</span>=<span class="string">&quot;0&quot;</span> au=<span class="string">&quot;https://www.sogou.com/web?bddn=9027558936136805&amp;brnd=6014570413749830&amp;&quot;</span> eu=<span class="string">&quot;&amp;lxoq=baidu&quot;</span>&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;m.baidu.com&quot;</span> r=<span class="string">&quot;0-11&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[m.baidu.com]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;baidu.com&quot;</span> r=<span class="string">&quot;0-9&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[baidu.com]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;%B0%D9%B6%C8&quot;</span> r=<span class="string">&quot;0-2&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[....]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;%B0%D9%B6%C8%D2%BB%CF%C2&quot;</span> r=<span class="string">&quot;0-4&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[........]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;baidu%B0%D9%B6%C8%CA%D7%D2%B3&quot;</span> r=<span class="string">&quot;0-9&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[baidu........]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;%B0%D9%B6%C8%B7%AD%D2%EB&quot;</span> r=<span class="string">&quot;0-4&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[........]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;188baidu&quot;</span> r=<span class="string">&quot;0-8&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[188baidu]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;%B0%D9%B6%C8%B5%D8%CD%BC&quot;</span> r=<span class="string">&quot;0-4&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[........]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;baidu%B0%D9%B6%C8%D2%BB%CF%C2%B9%D9%CD%F8&quot;</span> r=<span class="string">&quot;0-11&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[baidu............]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">    &lt;e&gt;</span><br><span class="line">        &lt;l h=<span class="string">&quot;1&quot;</span> d=<span class="string">&quot;0&quot;</span> vr=<span class="string">&quot;0&quot;</span> r=<span class="string">&quot;0&quot;</span> s=<span class="string">&quot;1&quot;</span> t=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">            &lt;t t=<span class="string">&quot;0&quot;</span> u=<span class="string">&quot;query=&quot;</span> sw=<span class="string">&quot;%B0%D9%B6%C8%CE%C4%BF%E2&quot;</span> r=<span class="string">&quot;0-4&quot;</span> tp=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">                &lt;w s=<span class="string">&quot;;1;;;;;;&quot;</span>&gt;&lt;![CDATA[........]]&gt;&lt;/w&gt;</span><br><span class="line">            &lt;/t&gt;</span><br><span class="line">        &lt;/l&gt;</span><br><span class="line">    &lt;/e&gt;</span><br><span class="line">&lt;/sg&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>http响应不规范，这就导致经过高级封装的一些操作http的库没有办法正确解析响应的内容，这时候就需要采用更原始的方法了，也就是不考虑http是否规范，直接在tcp层面获取原始tcp报文，再进行解析:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标服务器的IP地址和端口</span></span><br><span class="line">host = <span class="string">&#x27;192.168.31.188&#x27;</span></span><br><span class="line">port = <span class="number">80</span>  <span class="comment"># HTTP默认端口是80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个socket对象</span></span><br><span class="line">client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到服务器</span></span><br><span class="line">client_socket.connect((host, port))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建HTTP GET请求</span></span><br><span class="line">request = <span class="string">f&quot;GET / HTTP/1.1\r\nHost: <span class="subst">&#123;host&#125;</span>\r\nConnection: close\r\n\r\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送请求</span></span><br><span class="line">client_socket.sendall(request.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收响应数据</span></span><br><span class="line">response = <span class="string">b&quot;&quot;</span></span><br><span class="line">buffer_size = <span class="number">1024</span>  <span class="comment"># 缓冲区大小</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    buffer = client_socket.recv(buffer_size)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> buffer:</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># 如果没有更多数据，退出循环</span></span><br><span class="line">    response += buffer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">client_socket.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印接收到的原始响应数据</span></span><br><span class="line"><span class="built_in">print</span>(response.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))  <span class="comment"># 假设响应内容是UTF-8编码的，忽略解码错误</span></span><br></pre></td></tr></table></figure>

<p>这样就能正确获取到想要的http响应内容了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/01/%E5%A4%84%E7%90%86%E9%9D%9E%E6%A0%87%E5%87%86http%E5%93%8D%E5%BA%94/" data-id="cm9zmq8zv00eisqhl9k49hz9y" data-title="处理非标准http响应" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-B站视频合集下载" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/06/14/B%E7%AB%99%E8%A7%86%E9%A2%91%E5%90%88%E9%9B%86%E4%B8%8B%E8%BD%BD/" class="article-date">
  <time class="dt-published" datetime="2024-06-13T16:29:35.000Z" itemprop="datePublished">2024-06-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/06/14/B%E7%AB%99%E8%A7%86%E9%A2%91%E5%90%88%E9%9B%86%E4%B8%8B%E8%BD%BD/">B站视频合集下载</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>在拥有视频链接的情况下，可以使用you-get直接下载视频，如 <code>you-get https://www.bilibili.com/xxxxxxxx</code>非常方便。因此只要获取到视频合集中的所有视频链接即可</p>
<h2 id="分析网页源代码"><a href="#分析网页源代码" class="headerlink" title="分析网页源代码"></a>分析网页源代码</h2><p>观察发现B站的视频唯一ID是这一串字符串，后面的可以删去，猜测可能是用户相关的信息，分享视频时用于标记分享用户之类的（所以分享B站视频时建议删去后面一长串，不然应该可以跟踪到分享者的账号信息），合集视频ID之间没有明显规律<br><img src="https://xinhaojin.github.io/picx-images-hosting/20240613/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240613234826.ibz20r8fm.jpg"><br>查看网页源代码，搜索这一段ID，可以获知视频ID这个属性被命名为 <code>bvid</code><br><img src="https://xinhaojin.github.io/picx-images-hosting/20240613/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240613234816.2yy7gxxy57.jpg"><br>搜索 <code>bvid</code>，发现有180个，我的这个合集视频有46个，合理猜测46个链接应该在这180里面，搜索往下跳转翻到合集第一个视频的 <code>bvid</code>，再往下翻发现确实合集所有链接都有<br><img src="https://xinhaojin.github.io/picx-images-hosting/20240613/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240613235054.esd4b1ky3.jpg"><br>观察前后代码发现这些信息存在一个名为 <code>window.__INITIAL_STATE__</code>的JSON中，只要把这个JSON从HTML源代码中提取出来，再分析结构即可</p>
<h2 id="获取bvid所在JSON"><a href="#获取bvid所在JSON" class="headerlink" title="获取bvid所在JSON"></a>获取bvid所在JSON</h2><p>问一下GPT怎么写这个对应的正则表达式，把JSON从HTML中提取出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;referer&#x27;</span>: <span class="string">&#x27;https://www.bilibili.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url=<span class="string">&#x27;https://www.bilibili.com/video/BV1QG411z7gZ&#x27;</span><span class="comment">#合集中任意一集的地址</span></span><br><span class="line">response=requests.get(url,headers=headers)</span><br><span class="line">response.encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">html=response.text</span><br><span class="line"><span class="comment"># with open(B.html&#x27;,&#x27;r&#x27;,encoding=&#x27;utf-8&#x27;) as f:# 有时候会触发风控策略HTML获取失败，手动保存网页源代码再读取即可</span></span><br><span class="line"><span class="comment">#     html=f.read()</span></span><br><span class="line"><span class="comment"># 正则表达式匹配 window.__INITIAL_STATE__=到;(function的内容</span></span><br><span class="line">json_str =re.findall(<span class="string">r&quot;window\.__INITIAL_STATE__=(.*?);\(function\(&quot;</span>,html)[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># json.loads将json字符串转换为字典</span></span><br><span class="line">json_data=json.loads(json_str)</span><br></pre></td></tr></table></figure>

<h2 id="解析JSON获取视频链接"><a href="#解析JSON获取视频链接" class="headerlink" title="解析JSON获取视频链接"></a>解析JSON获取视频链接</h2><p><code>bvid</code>在JSON中的结构如下<br><img src="https://xinhaojin.github.io/picx-images-hosting/20240613/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240613223912.lxdfga0l.jpg"><br>代码如下,其中 <code>big_title</code>是合集标题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">big_title=videos=json_data[<span class="string">&quot;videoData&quot;</span>][<span class="string">&quot;ugc_season&quot;</span>][<span class="string">&quot;title&quot;</span>].replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">videos=json_data[<span class="string">&quot;videoData&quot;</span>][<span class="string">&quot;ugc_season&quot;</span>][<span class="string">&quot;sections&quot;</span>][<span class="number">0</span>][<span class="string">&quot;episodes&quot;</span>]</span><br><span class="line">titles=[video[<span class="string">&#x27;title&#x27;</span>].replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> video <span class="keyword">in</span> videos]</span><br><span class="line">urls=[<span class="string">&#x27;https://www.bilibili.com/video/&#x27;</span>+video[<span class="string">&#x27;bvid&#x27;</span>] <span class="keyword">for</span> video <span class="keyword">in</span> videos]</span><br><span class="line"><span class="built_in">print</span>(big_title)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(titles)):</span><br><span class="line">    <span class="built_in">print</span>(titles[i]+<span class="string">&#x27; &#x27;</span>+urls[i])</span><br></pre></td></tr></table></figure>

<h2 id="利用you-get自动批量下载"><a href="#利用you-get自动批量下载" class="headerlink" title="利用you-get自动批量下载"></a>利用you-get自动批量下载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install you-get</span><br></pre></td></tr></table></figure>

<p>you-get支持下载B站视频（非会员视频），(之前尝试过西瓜视频不支持…)，默认似乎会下载480p视频，如果需要更高清的视频，需要指定cookie，默认会下载能够支持的最高清晰度。</p>
<p>主要参数：</p>
<ul>
<li>-o 保存文件夹</li>
<li>-O 文件名(不加后缀)</li>
<li>-c cookies.txt的地址(Netscape格式(不是JSON格式)，可以从浏览器插件EditCookies中导出复制到txt中)</li>
</ul>
<p>代码如下，注意：不指定文件名，默认文件名是视频在网页中的大标题，与合集中的标题名称可能不同，这里代码中的title是合集列表中的标题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">basedir=<span class="string">&#x27;G:/&#x27;</span><span class="comment">#保存目录</span></span><br><span class="line"><span class="comment"># 使用you-get下载视频</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(basedir,big_title)):</span><br><span class="line">    os.makedirs(os.path.join(basedir,big_title))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;文件夹&#x27;</span>+big_title+<span class="string">&#x27;创建成功&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(titles)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;准备下载 &quot;</span>+os.path.join(basedir,big_title,titles[i]+<span class="string">&#x27;.mp4&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span>(os.path.exists(os.path.join(basedir,big_title,titles[i]+<span class="string">&#x27;.mp4&#x27;</span>))):</span><br><span class="line">        <span class="built_in">print</span>(titles[i]+<span class="string">&#x27;已存在&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    os.system(<span class="string">&#x27;you-get -c cookies.txt -o &#x27;</span>+os.path.join(basedir,big_title)+<span class="string">&#x27; -O &#x27;</span>+titles[i]+<span class="string">&#x27; &#x27;</span>+urls[i])</span><br><span class="line">    <span class="built_in">print</span>(titles[i]+<span class="string">&#x27; 下载完成&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>另外，最新版的you-get会默认下载弹幕文件xml，没仔细看这是什么参数怎么取消下载，也无所谓吧，我手动删了一下</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/06/14/B%E7%AB%99%E8%A7%86%E9%A2%91%E5%90%88%E9%9B%86%E4%B8%8B%E8%BD%BD/" data-id="cm9zmq8wl0003sqhlf6176ibq" data-title="B站视频合集下载" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/" rel="tag">视频下载</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-私有化部署局域网文件传输工具Snapdrop" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/06/04/%E7%A7%81%E6%9C%89%E5%8C%96%E9%83%A8%E7%BD%B2%E5%B1%80%E5%9F%9F%E7%BD%91%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7Snapdrop/" class="article-date">
  <time class="dt-published" datetime="2024-06-04T14:55:56.000Z" itemprop="datePublished">2024-06-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/06/04/%E7%A7%81%E6%9C%89%E5%8C%96%E9%83%A8%E7%BD%B2%E5%B1%80%E5%9F%9F%E7%BD%91%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7Snapdrop/">私有化部署局域网文件传输工具Snapdrop</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前想过很多次做一个局域网文件传输工具，但是始终停留在需求阶段哈哈哈哈哈，毕竟啥也不会。</p>
<p>网上有很多软件可以用，但基本都是要安装各平台的软件才行，作为偶尔用一下的工具，必不可能有被安装在设备上的资格。</p>
<p>之前用过一个很好用的工具Snapdrop，以网页形式存在，<a target="_blank" rel="noopener" href="https://snapdrop.net/">https://Snapdrop.net/</a> ，完全满足了我的需求，但后面有段时间无法访问，我以为他凉了。</p>
<p>因此我又重新想做一个类似的东西，结果发现这个网页现在又可以用了，关于页指向GitHub <a target="_blank" rel="noopener" href="https://github.com/RobinLinus/snapdrop">https://github.com/RobinLinus/snapdrop</a> ，竟然是开源的，大喜过望，于是有了本篇。</p>
<h2 id="前置环境"><a href="#前置环境" class="headerlink" title="前置环境"></a>前置环境</h2><p>docker，nginx，域名</p>
<h2 id="docker配置"><a href="#docker配置" class="headerlink" title="docker配置"></a>docker配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull linuxserver/snapdrop</span><br><span class="line">docker run -d --restart=always --name snapdrop -p 8088:80 linuxserver/snapdrop #8088是自定义端口</span><br></pre></td></tr></table></figure>

<p>然后就可以在客户端双方访问<a target="_blank" rel="noopener" href="http://ip:8088/">http://ip:8088</a> 来使用，若要绑定域名，进行nginx设置</p>
<h2 id="申请SSL证书"><a href="#申请SSL证书" class="headerlink" title="申请SSL证书"></a>申请SSL证书</h2><p>先解析一个二级域名如file.xinhaojin.top到主机上,然后申请证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install certbot python3-certbot-nginx</span><br><span class="line">sudo certbot --nginx -d file.xinhaojin.top</span><br></pre></td></tr></table></figure>

<h2 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h2><p>在http标签中添加两个server</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name file.xinhaojin.top;</span><br><span class="line">    return <span class="number">301</span> https<span class="punctuation">:</span><span class="comment">//$host$request_uri;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">443</span> ssl;</span><br><span class="line">    server_name file.xinhaojin.top;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/file.xinhaojin.top/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/file.xinhaojin.top/privkey.pem;</span><br><span class="line">    ssl_protocols TLSv1<span class="number">.2</span> TLSv1<span class="number">.3</span>;</span><br><span class="line">    ssl_prefer_server_ciphers off;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256<span class="punctuation">:</span>ECDHE-RSA-AES256-GCM-SHA384;</span><br><span class="line"></span><br><span class="line">    location / <span class="punctuation">&#123;</span></span><br><span class="line">        proxy_pass http<span class="punctuation">:</span><span class="comment">//127.0.0.1:8088;  # Change to your Spring Boot app&#x27;s IP and port</span></span><br><span class="line">        proxy_connect_timeout <span class="number">300</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header X-Forwarded-for $remote_addr;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">location ~ /.well-known <span class="punctuation">&#123;</span></span><br><span class="line">    allow all;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>重启nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h2><p>现在就拥有了一个私有化的局域网文件传输工具，<a target="_blank" rel="noopener" href="https://file.xinhaojin.top/">https://file.xinhaojin.top</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/06/04/%E7%A7%81%E6%9C%89%E5%8C%96%E9%83%A8%E7%BD%B2%E5%B1%80%E5%9F%9F%E7%BD%91%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7Snapdrop/" data-id="cm9zmq90l00hpsqhl71nvhe7s" data-title="私有化部署局域网文件传输工具Snapdrop" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/" rel="tag">局域网</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-非华为电脑制作NFC贴片实现一碰传多屏协同" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/25/%E9%9D%9E%E5%8D%8E%E4%B8%BA%E7%94%B5%E8%84%91%E5%88%B6%E4%BD%9CNFC%E8%B4%B4%E7%89%87%E5%AE%9E%E7%8E%B0%E4%B8%80%E7%A2%B0%E4%BC%A0%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" class="article-date">
  <time class="dt-published" datetime="2024-05-25T13:40:12.000Z" itemprop="datePublished">2024-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/05/25/%E9%9D%9E%E5%8D%8E%E4%B8%BA%E7%94%B5%E8%84%91%E5%88%B6%E4%BD%9CNFC%E8%B4%B4%E7%89%87%E5%AE%9E%E7%8E%B0%E4%B8%80%E7%A2%B0%E4%BC%A0%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/">非华为电脑制作NFC贴片实现一碰传多屏协同</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装华为电脑管家"><a href="#安装华为电脑管家" class="headerlink" title="安装华为电脑管家"></a>安装华为电脑管家</h2><p>网卡要求：英特尔AX200系列确认没问题，其余网卡可能无法安装华为电脑管家。</p>
<p>手机必须是华为手机，鸿蒙2.0以上，处理器在麒麟990以上。</p>
<p>具体可参考B站博主空降猫咪的教程安装：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19H4y1G7Dg">https://www.bilibili.com/video/BV19H4y1G7Dg</a></p>
<p>相关文件在作者视频简介中有网盘链接</p>
<p>需要注意的一点是SN码设置(后续会用到)，SN码选择自定义，设置为16位长的字母数字组合，然后再选择安装包安装。</p>
<p><img src="https://xinhaojin.github.io/picx-images-hosting/20240525/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240525220224.5c0t6wg2x3.jpg"></p>
<h2 id="给NFC贴纸写入数据，并激活"><a href="#给NFC贴纸写入数据，并激活" class="headerlink" title="给NFC贴纸写入数据，并激活"></a>给NFC贴纸写入数据，并激活</h2><h3 id="生成二维码"><a href="#生成二维码" class="headerlink" title="生成二维码"></a>生成二维码</h3><p>使用PCManagerInstaller生成二维码。(就是上一步骤中的安装器):<a target="_blank" rel="noopener" href="https://xinhaojin.lanzouj.com/iYXPD1zqz68h">https://xinhaojin.lanzouj.com/iYXPD1zqz68h</a><br><img src="https://xinhaojin.github.io/picx-images-hosting/20240525/image.7ljtqefn2j.jpg"><br>然后使用微信或者浏览器先扫描二维码内容，查看数据格式是否形如“SN&#x3D;HUAWEILAPTOP2020|MAC&#x3D;BC8385DC117F|MODELID&#x3D;00000506”其中SN是上一步自己设置的。</p>
<h3 id="使用一碰传助手扫码激活"><a href="#使用一碰传助手扫码激活" class="headerlink" title="使用一碰传助手扫码激活"></a>使用一碰传助手扫码激活</h3><p>安装华为一碰传助手：<a target="_blank" rel="noopener" href="https://xinhaojin.lanzouj.com/iHSYu1zqz6dc%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%89%93%E5%BC%80%E5%90%8E%E4%B8%8D%E8%83%BD%E7%94%A8%E8%AF%B7%E5%9C%A8%E8%AE%BE%E7%BD%AE%E9%87%8C%E6%8E%88%E4%BA%88%E7%9B%B8%E6%9C%BA%E6%9D%83%E9%99%90%EF%BC%8C%E6%89%AB%E8%BF%99%E4%B8%AA%E7%94%9F%E6%88%90%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81">https://xinhaojin.lanzouj.com/iHSYu1zqz6dc，如果打开后不能用请在设置里授予相机权限，扫这个生成的二维码</a><br><img src="https://xinhaojin.github.io/picx-images-hosting/20240525/9bd0d3780c47789217054243dbd5bc9.9gwej12key.jpg"><br>然后把NFC贴纸放在感应区两秒，提示激活成功即可。<br><img src="https://xinhaojin.github.io/picx-images-hosting/20240525/dc35512f61d64ca61f7c60932cee80e.7p4hn63a1.jpg"><br>NFC tools(用于NFC写卡错误时删除标签数据，华为手机似乎无法直接使用，其他安卓机可用):<a target="_blank" rel="noopener" href="https://xinhaojin.lanzouj.com/itbaa1zqz6ih">https://xinhaojin.lanzouj.com/itbaa1zqz6ih</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/05/25/%E9%9D%9E%E5%8D%8E%E4%B8%BA%E7%94%B5%E8%84%91%E5%88%B6%E4%BD%9CNFC%E8%B4%B4%E7%89%87%E5%AE%9E%E7%8E%B0%E4%B8%80%E7%A2%B0%E4%BC%A0%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" data-id="cm9zmq90t00issqhl8zfob49u" data-title="非华为电脑制作NFC贴片实现一碰传多屏协同" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NFC/" rel="tag">NFC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" rel="tag">多屏协同</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用PandoraNext项目Docker部署ChatGPT官网镜像站(支持Token登录)，同时为Chatgpt-web项目提供稳定代理服务" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/17/%E4%BD%BF%E7%94%A8PandoraNext%E9%A1%B9%E7%9B%AEDocker%E9%83%A8%E7%BD%B2ChatGPT%E5%AE%98%E7%BD%91%E9%95%9C%E5%83%8F%E7%AB%99(%E6%94%AF%E6%8C%81Token%E7%99%BB%E5%BD%95)%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BAChatgpt-web%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BE%9B%E7%A8%B3%E5%AE%9A%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1/" class="article-date">
  <time class="dt-published" datetime="2024-01-17T06:23:01.000Z" itemprop="datePublished">2024-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/17/%E4%BD%BF%E7%94%A8PandoraNext%E9%A1%B9%E7%9B%AEDocker%E9%83%A8%E7%BD%B2ChatGPT%E5%AE%98%E7%BD%91%E9%95%9C%E5%83%8F%E7%AB%99(%E6%94%AF%E6%8C%81Token%E7%99%BB%E5%BD%95)%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BAChatgpt-web%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BE%9B%E7%A8%B3%E5%AE%9A%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1/">使用PandoraNext项目Docker部署ChatGPT官网镜像站(支持Token登录)，同时为Chatgpt-web项目提供稳定代理服务</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>chatgpt-web项目<a target="_blank" rel="noopener" href="https://github.com/Chanzhaoyu/chatgpt-web">https://github.com/Chanzhaoyu/chatgpt-web</a>稳定性太差，经常出现代理失效的问题，在issues中看到pandoranext项目<a target="_blank" rel="noopener" href="https://github.com/pandora-next/deploy">https://github.com/pandora-next/deploy</a>可以自建代理为chatgpt-web提供服务，同时本身可作为chatgpt官网镜像站，支持accesstoken登录，无需付费apikey，相当于官网网页对话使用。</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>一台境外服务器(可直连OpenAI官网，有Docker、Nginx)，一个半年以上的github账号，一个域名</p>
<h2 id="部署镜像站"><a href="#部署镜像站" class="headerlink" title="部署镜像站"></a>部署镜像站</h2><h3 id="创建根目录"><a href="#创建根目录" class="headerlink" title="创建根目录"></a>创建根目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir pandora-next</span><br><span class="line">cd pandora-next</span><br></pre></td></tr></table></figure>

<h3 id="获取License"><a href="#获取License" class="headerlink" title="获取License"></a>获取License</h3><p>访问<a target="_blank" rel="noopener" href="https://dash.pandoranext.com/">https://dash.pandoranext.com</a>登录github账号获取授权<img src="https://xinhaojin.github.io/imgs-host/20240117/1705471881491.jpg" alt="1705471881491"></p>
<h3 id="复制网页上的curl命令并执行"><a href="#复制网页上的curl命令并执行" class="headerlink" title="复制网页上的curl命令并执行"></a>复制网页上的curl命令并执行</h3><p>项目根目录下出现一个jwt文件</p>
<h3 id="创建docker-compose-yml"><a href="#创建docker-compose-yml" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h3><p>把PANDORA_NEXT_LICENSE后的xxx改成刚刚获取的jwt文件中的值</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pandora-next:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pengzhile/pandora-next</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">PandoraNext</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8181:8181&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PANDORA_NEXT_LICENSE=xxx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br></pre></td></tr></table></figure>

<h3 id="创建其他文件（夹）"><a href="#创建其他文件（夹）" class="headerlink" title="创建其他文件（夹）"></a>创建其他文件（夹）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br><span class="line">cd data</span><br><span class="line">vi config.json</span><br><span class="line">vi tokens.json</span><br></pre></td></tr></table></figure>

<p>config.json<br>修改license_id，授权网页上有</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;bind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0:8181&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cert_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;key_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">600</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-L1xxxxxxxi9w&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;proxy_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;public_share&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;site_password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;setup_password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;server_tokens&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;proxy_api_prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isolated_conv_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;captcha&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;site_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;site_secret&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;site_login&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;setup_login&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;oai_username&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;oai_password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;whitelist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>tokens.json<br>可以修改预设登录方式，默认即可</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test-1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;access token / session token / refresh token&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;show_user_info&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test-2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;access token / session token / refresh token&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;show_user_info&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plus&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;access token / session token / refresh token / share token&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12345&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="在项目根目录下（docker-compose-yml所在文件夹）执行docker命令"><a href="#在项目根目录下（docker-compose-yml所在文件夹）执行docker命令" class="headerlink" title="在项目根目录下（docker-compose.yml所在文件夹）执行docker命令"></a>在项目根目录下（docker-compose.yml所在文件夹）执行docker命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker-compose ps #查看运行状态</span><br></pre></td></tr></table></figure>

<h3 id="放开8181端口，访问http-IP-8181"><a href="#放开8181端口，访问http-IP-8181" class="headerlink" title="放开8181端口，访问http://IP:8181"></a>放开8181端口，访问<a target="_blank" rel="noopener" href="http://ip:8181/">http://IP:8181</a></h3><p>如果顺利的话，可以看到chatgpt镜像站登录页面，可以使用注册邮箱登录，或者使用accesstoken登录（accesstoken可以在<a target="_blank" rel="noopener" href="https://chat.openai.com/api/auth/session%E8%8E%B7%E5%8F%96%EF%BC%89%E3%80%82">https://chat.openai.com/api/auth/session获取）。</a><br><img src="https://xinhaojin.github.io/imgs-host/20240117/1705473448886.jpg" alt="1705473448886"><br>如果确认端口放开但仍旧不能访问，使用docker logs命令查看日志信息，会有错误提示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs PandoraNext</span><br></pre></td></tr></table></figure>

<h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><h3 id="解析一个二级域名到服务器IP"><a href="#解析一个二级域名到服务器IP" class="headerlink" title="解析一个二级域名到服务器IP"></a>解析一个二级域名到服务器IP</h3><p>如pass.xinhaojin.top</p>
<h3 id="申请SSL证书"><a href="#申请SSL证书" class="headerlink" title="申请SSL证书"></a>申请SSL证书</h3><p>sudo apt install certbot python3-certbot-nginx<br>sudo certbot –nginx -d pass.xinhaojin.top</p>
<h3 id="添加nginx配置"><a href="#添加nginx配置" class="headerlink" title="添加nginx配置"></a>添加nginx配置</h3><p>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf<br>添加两个server，对应修改ssl证书位置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  pass.xinhaojin.top; </span><br><span class="line">        return <span class="number">301</span> https<span class="punctuation">:</span><span class="comment">//$host$request_uri;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  </span><br><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">        listen       <span class="number">443</span> ssl; </span><br><span class="line">        server_name   pass.xinhaojin.top;  </span><br><span class="line">      </span><br><span class="line">        ssl_certificate /etc/letsencrypt/live/pass.xinhaojin.top/fullchain.pem;</span><br><span class="line">        ssl_certificate_key /etc/letsencrypt/live/pass.xinhaojin.top/privkey.pem;</span><br><span class="line">  </span><br><span class="line">        ssl_protocols TLSv1<span class="number">.2</span>;  </span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256;  </span><br><span class="line"></span><br><span class="line">        location / <span class="punctuation">&#123;</span></span><br><span class="line">           proxy_pass http<span class="punctuation">:</span><span class="comment">//0.0.0.0:8181;</span></span><br><span class="line">           proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">           proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">           proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        <span class="punctuation">&#125;</span>   </span><br><span class="line">    <span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure>

<p>到此为止已经可以使用域名访问chatgpt镜像站了。</p>
<h2 id="为chatgpt-web项目提供代理服务"><a href="#为chatgpt-web项目提供代理服务" class="headerlink" title="为chatgpt-web项目提供代理服务"></a>为chatgpt-web项目提供代理服务</h2><h3 id="修改pandora-next-data-config-json"><a href="#修改pandora-next-data-config-json" class="headerlink" title="修改pandora-next&#x2F;data&#x2F;config.json"></a>修改pandora-next&#x2F;data&#x2F;config.json</h3><p>添加代理前缀，注意英文数字都要有，长度&gt;&#x3D;8,这也是看了logs才发现的规则</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;proxy_api_prefix&quot;:</span> <span class="string">&quot;proxy2openai&quot;</span><span class="string">,</span></span><br></pre></td></tr></table></figure>

<h3 id="重启docker容器"><a href="#重启docker容器" class="headerlink" title="重启docker容器"></a>重启docker容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart PandoraNext</span><br></pre></td></tr></table></figure>

<p>代理接口为https:&#x2F;&#x2F;域名&#x2F;前缀&#x2F;backend-api&#x2F;conversation,如<a target="_blank" rel="noopener" href="https://pass.xinhaojin.top/proxy2openai/backend-api/conversation">https://pass.xinhaojin.top/proxy2openai/backend-api/conversation</a>，访问正常会返回</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Method Not Allowed&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>chatgpt-web部署参考之前的文章<br><a target="_blank" rel="noopener" href="https://xinhaojin.github.io/2023/04/03/centos7%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2chatgpt/">https://xinhaojin.github.io/2023/04/03/centos7%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2chatgpt/</a>，只需在docker-compose.yml中修改API_REVERSE_PROXY即可</p>
<h2 id="注意定期更新accesstoken"><a href="#注意定期更新accesstoken" class="headerlink" title="注意定期更新accesstoken"></a>注意定期更新accesstoken</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/17/%E4%BD%BF%E7%94%A8PandoraNext%E9%A1%B9%E7%9B%AEDocker%E9%83%A8%E7%BD%B2ChatGPT%E5%AE%98%E7%BD%91%E9%95%9C%E5%83%8F%E7%AB%99(%E6%94%AF%E6%8C%81Token%E7%99%BB%E5%BD%95)%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BAChatgpt-web%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BE%9B%E7%A8%B3%E5%AE%9A%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1/" data-id="cm9zmq8zm00dcsqhlbuj9ehtf" data-title="使用PandoraNext项目Docker部署ChatGPT官网镜像站(支持Token登录)，同时为Chatgpt-web项目提供稳定代理服务" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chatgpt/" rel="tag">chatgpt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ssh免密登录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/14/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2023-12-14T08:29:50.000Z" itemprop="datePublished">2023-12-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/14/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/">ssh免密登录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="本地生成公钥私钥"><a href="#本地生成公钥私钥" class="headerlink" title="本地生成公钥私钥"></a>本地生成公钥私钥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<h3 id="把本地的-ssh-id-rsa-pub内文本内容粘贴到远程主机的-ssh-authorized-keys中新建一行"><a href="#把本地的-ssh-id-rsa-pub内文本内容粘贴到远程主机的-ssh-authorized-keys中新建一行" class="headerlink" title="把本地的.ssh&#x2F;id_rsa.pub内文本内容粘贴到远程主机的.ssh&#x2F;authorized_keys中新建一行"></a>把本地的.ssh&#x2F;id_rsa.pub内文本内容粘贴到远程主机的.ssh&#x2F;authorized_keys中新建一行</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/12/14/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" data-id="cm9zmq8ym008nsqhlf2z2c7ud" data-title="ssh免密登录" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-SpringBoot+Redis长链接转短链接+Docker部署 " class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/21/SpringBoot+Redis%E9%95%BF%E9%93%BE%E6%8E%A5%E8%BD%AC%E7%9F%AD%E9%93%BE%E6%8E%A5+Docker%E9%83%A8%E7%BD%B2%20/" class="article-date">
  <time class="dt-published" datetime="2023-08-21T06:07:56.000Z" itemprop="datePublished">2023-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/21/SpringBoot+Redis%E9%95%BF%E9%93%BE%E6%8E%A5%E8%BD%AC%E7%9F%AD%E9%93%BE%E6%8E%A5+Docker%E9%83%A8%E7%BD%B2%20/">SpringBoot+Redis长链接转短链接+Docker部署</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>这是一个长链接转短链接的SpringBoot项目，利用Redis存储长短链接的键值关系</p>
<p><strong>github地址：<a target="_blank" rel="noopener" href="https://github.com/xinhaojin/short-url">https://github.com/xinhaojin/short-url</a></strong></p>
<p><strong>演示站点：<a target="_blank" rel="noopener" href="https://s.xinhaojin.top/">https://s.xinhaojin.top</a></strong></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>用Spring Initializr创建一个空项目，使用Java8、SpringBoot2版本，勾选spring web</p>
<h3 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h3><p>在resource&#x2F;static下创建index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>短链接生成器<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://xinhaojin.github.io/imgs-host/20230821/tutu.7cfpopzisy40.webp&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;16*16&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">10%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f4f4f4</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">80%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#0056b3</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#shortUrl</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#007bff</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.copy-message</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#28a745</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: opacity <span class="number">0.5s</span> ease-in-out;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>短链接生成器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;longUrl&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入原始长链接&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;shortenURL()&quot;</span>&gt;</span>生成短链接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>短链接: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;shortUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;copyToClipboard()&quot;</span>&gt;</span>复制到剪贴板<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;copy-message&quot;</span> <span class="attr">id</span>=<span class="string">&quot;copyMessage&quot;</span>&gt;</span>复制成功！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">shortenURL</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> longUrl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;longUrl&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">`/api/shorten?url=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(longUrl)&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">shortUrl</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> fullShortUrl = <span class="string">`https://s.xinhaojin.top/s/<span class="subst">$&#123;shortUrl&#125;</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> shortUrlElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;shortUrl&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                shortUrlElement.<span class="property">innerHTML</span> = <span class="string">`&lt;a href=&quot;<span class="subst">$&#123;fullShortUrl&#125;</span>&quot; target=&quot;_blank&quot;&gt;<span class="subst">$&#123;fullShortUrl&#125;</span>&lt;/a&gt;`</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">copyToClipboard</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> shortUrl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;shortUrl&#x27;</span>).<span class="property">textContent</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> tempInput = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        tempInput.<span class="property">value</span> = shortUrl;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(tempInput);</span></span><br><span class="line"><span class="language-javascript">        tempInput.<span class="title function_">select</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;copy&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(tempInput);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> copyMessage = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;copyMessage&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        copyMessage.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            copyMessage.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;1&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">10</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            copyMessage.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1500</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><p>MyController.java，给前端提供生成短链接和恢复长链接的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.xinhaojin.shorturl.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> top.xinhaojin.shorturl.service.MyService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造函数注入 MyService</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyController</span><span class="params">(MyService myService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.myService = myService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理生成短链接的请求</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/shorten&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">shortenURL</span><span class="params">(<span class="meta">@RequestParam</span> String url)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用 MyService 中的方法，生成短链接并返回</span></span><br><span class="line">        <span class="keyword">return</span> myService.shortenURL(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理还原长链接的请求</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/restore&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">restoreURL</span><span class="params">(<span class="meta">@RequestParam</span> String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用 MyService 中的方法，还原短链接为长链接并返回</span></span><br><span class="line">        <span class="keyword">return</span> myService.restoreURL(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedirectController.java,处理用户访问短链接时的重定向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.xinhaojin.shorturl.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> top.xinhaojin.shorturl.service.MyService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/s&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedirectController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedirectController</span><span class="params">(MyService myService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.myService = myService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;shortKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">redirect</span><span class="params">(<span class="meta">@PathVariable</span> String shortKey, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalUrl</span> <span class="operator">=</span> myService.restoreURL(shortKey);</span><br><span class="line">        <span class="keyword">if</span> (originalUrl != <span class="literal">null</span>) &#123;</span><br><span class="line">            response.sendRedirect(originalUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Handle not found case</span></span><br><span class="line">            response.sendError(HttpServletResponse.SC_NOT_FOUND);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>MyService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.xinhaojin.shorturl.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">shortenURL</span><span class="params">(String longURL)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 自动添加 http:// 前缀</span></span><br><span class="line">            <span class="keyword">if</span> (!longURL.startsWith(<span class="string">&quot;http://&quot;</span>) &amp;&amp; !longURL.startsWith(<span class="string">&quot;https://&quot;</span>)) &#123;</span><br><span class="line">                longURL = <span class="string">&quot;http://&quot;</span> + longURL;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!isValidURL(longURL)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;invalid&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">shortKey</span> <span class="operator">=</span> generateShortKey(longURL);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检查是否已存在相同的短链接</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">existingLongURL</span> <span class="operator">=</span> redisTemplate.opsForValue().get(shortKey);</span><br><span class="line">            <span class="keyword">if</span> (existingLongURL != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> shortKey;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将短链接与长链接映射关系存储到 Redis 中</span></span><br><span class="line">            redisTemplate.opsForValue().set(shortKey, longURL);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> shortKey;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">restoreURL</span><span class="params">(String shortKey)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 从 Redis 中获取短链接对应的长链接</span></span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForValue().get(shortKey);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DataAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateShortKey</span><span class="params">(String longURL)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建 MD5 哈希函数实例</span></span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            md.update(longURL.getBytes());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取生成的哈希字节数组</span></span><br><span class="line">            <span class="type">byte</span>[] hashBytes = md.digest();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 转换为固定长度的十六进制字符串</span></span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">byte</span> b : hashBytes) &#123;</span><br><span class="line">                sb.append(String.format(<span class="string">&quot;%02x&quot;</span>, b &amp; <span class="number">0xff</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 截取前 8 个字符作为短链接</span></span><br><span class="line">            <span class="keyword">return</span> sb.substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 在实际应用中，可以返回默认的短链接或其他处理方式</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;default123&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isValidURL</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用简单的正则表达式验证是否为合法网址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^(http|https)://[a-zA-Z0-9.-]+\\.[a-zA-Z]&#123;2,6&#125;(/.*)?$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(regex, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.host=1.15.xx.xxx</span><br><span class="line">spring.redis.port=6379</span><br><span class="line"></span><br><span class="line">server.port=7777</span><br></pre></td></tr></table></figure>

<h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.xinhaojin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>short-url<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>short-url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>short-url<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="docker部署"><a href="#docker部署" class="headerlink" title="docker部署"></a>docker部署</h2><h3 id="在项目根目录终端下执行以下maven命令，会在target下生成jar文件"><a href="#在项目根目录终端下执行以下maven命令，会在target下生成jar文件" class="headerlink" title="在项目根目录终端下执行以下maven命令，会在target下生成jar文件"></a>在项目根目录终端下执行以下maven命令，会在target下生成jar文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package</span><br></pre></td></tr></table></figure>

<h3 id="新建一个名为Dockerfile的文件，内容如下"><a href="#新建一个名为Dockerfile的文件，内容如下" class="headerlink" title="新建一个名为Dockerfile的文件，内容如下"></a>新建一个名为Dockerfile的文件，内容如下</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用一个基础的 Java 镜像</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 JAR 文件到容器中</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> your-application-name-version.jar /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露应用程序运行的端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7777</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行 Spring Boot 应用程序</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="在有docker环境的地方如安装了docker的Ubuntu服务器上，创建docker镜像"><a href="#在有docker环境的地方如安装了docker的Ubuntu服务器上，创建docker镜像" class="headerlink" title="在有docker环境的地方如安装了docker的Ubuntu服务器上，创建docker镜像"></a>在有docker环境的地方如安装了docker的Ubuntu服务器上，创建docker镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker build -t your-image-name:your-tag .</span></span><br><span class="line">docker build -t short-url:v1.0 .</span><br></pre></td></tr></table></figure>

<h3 id="运行docker镜像"><a href="#运行docker镜像" class="headerlink" title="运行docker镜像"></a>运行docker镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -d -p 7777:7777 your-image-name:tag</span></span><br><span class="line">docker run --restart=always --name shorturl -d -p 7777:7777 short-url:v1.0</span><br></pre></td></tr></table></figure>

<h3 id="检查运行情况"><a href="#检查运行情况" class="headerlink" title="检查运行情况"></a>检查运行情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<h2 id="绑定域名-用nginx做好反向代理"><a href="#绑定域名-用nginx做好反向代理" class="headerlink" title="绑定域名,用nginx做好反向代理"></a>绑定域名,用nginx做好反向代理</h2><p>解析一个二级域名到目标服务器，如s.xinhaojin.top</p>
<h3 id="查看nginx版本，如果没有，就安装"><a href="#查看nginx版本，如果没有，就安装" class="headerlink" title="查看nginx版本，如果没有，就安装"></a>查看nginx版本，如果没有，就安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install nginx</span><br></pre></td></tr></table></figure>

<h3 id="修改-etc-nginx-nginx-conf"><a href="#修改-etc-nginx-nginx-conf" class="headerlink" title="修改&#x2F;etc&#x2F;nginx&#x2F;nginx.conf"></a>修改&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</h3><p>在http标签里添加一个server</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">		<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">		<span class="attribute">server_name</span> s.xinhaojin.top;</span><br><span class="line"></span><br><span class="line">		<span class="section">location</span> / &#123;</span><br><span class="line">			<span class="attribute">proxy_pass</span> http://1.15.xx.xxx:7777;</span><br><span class="line">			<span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">			<span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">			<span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">			<span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查-Nginx-服务是否已经存在于-systemd-中："><a href="#检查-Nginx-服务是否已经存在于-systemd-中：" class="headerlink" title="检查 Nginx 服务是否已经存在于 systemd 中："></a>检查 Nginx 服务是否已经存在于 systemd 中：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl is-enabled nginx</span><br></pre></td></tr></table></figure>

<p>如果返回 disabled，则表示 Nginx 目前不会开机自启。<br>如果 Nginx 尚未开机自启，可以使用以下命令启用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure>

<h3 id="申请SSL证书"><a href="#申请SSL证书" class="headerlink" title="申请SSL证书"></a>申请SSL证书</h3><p>安装certbot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install certbot</span><br></pre></td></tr></table></figure>

<p>临时关闭nginx以释放80端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl stop nginx</span><br><span class="line"><span class="built_in">sudo</span> certbot certonly --standalone -d s.xinhaojin.top</span><br></pre></td></tr></table></figure>

<h3 id="修改nginx配置-etc-nginx-nginx-conf"><a href="#修改nginx配置-etc-nginx-nginx-conf" class="headerlink" title="修改nginx配置&#x2F;etc&#x2F;nginx&#x2F;nginx.conf"></a>修改nginx配置&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</h3><p>把上一个server删去，替换以下代码</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> s.xinhaojin.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> s.xinhaojin.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/s.xinhaojin.top/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/s.xinhaojin.top/privkey.pem;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:7777;  <span class="comment"># Change to your Spring Boot app&#x27;s IP and port</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /.well-known</span> &#123;</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start nginx</span><br><span class="line"><span class="built_in">sudo</span> systemctl reload nginx</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/08/21/SpringBoot+Redis%E9%95%BF%E9%93%BE%E6%8E%A5%E8%BD%AC%E7%9F%AD%E9%93%BE%E6%8E%A5+Docker%E9%83%A8%E7%BD%B2%20/" data-id="cm9zmq8x10010sqhl7m5nezqy" data-title="SpringBoot+Redis长链接转短链接+Docker部署" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hexo博客迁移" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/04/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/" class="article-date">
  <time class="dt-published" datetime="2023-07-04T11:30:00.000Z" itemprop="datePublished">2023-07-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/04/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/">hexo博客迁移</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="hexo博客迁移"><a href="#hexo博客迁移" class="headerlink" title="hexo博客迁移"></a>hexo博客迁移</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最开始使用wordpress写博客，方便是方便，但感觉不够干净、不够优雅，所以后来开始写markdown格式的博客，使用hexo部署在github上，但是平时使用的电脑有很多台，GitHub上公开的又只有public文件夹的静态页面，没有把markwodn文件一并提交，因此也不能通过github来同步，所以就想干脆把hexo项目放在云服务器上，要写新文章就写好markdown上传到云服务器去提交，也省的在各个电脑上配置。本文简要介绍把hexo项目迁移到云服务器上的步骤。</p>
<ul>
<li>2024.10.2第二次修改，不再部署到云服务器，以下是在本地新机器上的部署步骤</li>
</ul>
<h3 id="安装nodejs、Hexo和其他依赖"><a href="#安装nodejs、Hexo和其他依赖" class="headerlink" title="安装nodejs、Hexo和其他依赖"></a>安装nodejs、Hexo和其他依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line">mkdir blog</span><br><span class="line">cd blog</span><br><span class="line">hexo init</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主题</span></span><br><span class="line">npm install --save hexo-theme-fluid</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">评论插件</span></span><br><span class="line">npm i --save gitalk</span><br></pre></td></tr></table></figure>

<h3 id="建立git连接"><a href="#建立git连接" class="headerlink" title="建立git连接"></a>建立git连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;xinhaojin&quot;</span><br><span class="line">git config --global user.email &quot;xinhaojin@qq.com&quot;</span><br><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;xinhaojin@qq.com&quot;</span><br></pre></td></tr></table></figure>

<p>把公钥&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub中的内容添加到github-setting-ssh key</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>修改_config.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">title: xinhaojin&#x27;s blog</span><br><span class="line">keywords:</span><br><span class="line">author: xinhaojin</span><br><span class="line">language: zh-CN</span><br><span class="line"></span><br><span class="line">theme: fulid</span><br><span class="line">deploy:</span><br><span class="line">  type: &#x27;git&#x27;</span><br><span class="line">  repository:  git@github.com:xinhaojin/xinhaojin.github.io.git</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure>

<h3 id="更新博客"><a href="#更新博客" class="headerlink" title="更新博客"></a>更新博客</h3><p>上传markdown到blog&#x2F;source&#x2F;_posts文件夹<br>然后就可以发布新文章了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>markdown模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章标题</span><br><span class="line">tags: []</span><br><span class="line">categories:</span><br><span class="line">  - - 软件安装配置</span><br><span class="line">date: 2023-05-20 13:30:00</span><br><span class="line">---</span><br><span class="line">## xxx</span><br><span class="line">### xxx</span><br><span class="line">![](url)</span><br><span class="line">&lt;url&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/07/04/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/" data-id="cm9zmq8xn003rsqhlfmul7civ" data-title="hexo博客迁移" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/LeetCode/">LeetCode</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/%E6%9D%82/">杂</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/python/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/%E6%9D%82/">杂</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/">pytorch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/">目标检测</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E5%B7%A5/">网工</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">软件安装配置</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/linux/">linux</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDN/" rel="tag">CDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDNS/" rel="tag">DDNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DHCP/" rel="tag">DHCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/" rel="tag">DNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IP/" rel="tag">IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPsec/" rel="tag">IPsec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LDA/" rel="tag">LDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFC/" rel="tag">NFC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PDF/" rel="tag">PDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMTP/" rel="tag">SMTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chatgpt/" rel="tag">chatgpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudflare/" rel="tag">cloudflare</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ocr/" rel="tag">ocr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyinstaller/" rel="tag">pyinstaller</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpa/" rel="tag">rpa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/" rel="tag">wget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wol/" rel="tag">wol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wordpress/" rel="tag">wordpress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/worldcloud/" rel="tag">worldcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="tag">二叉树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E7%9B%98/" rel="tag">云盘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B/" rel="tag">人脸检测</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE/" rel="tag">倍速播放</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">内网穿透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%9B%AE%E6%91%84%E5%83%8F%E5%A4%B4%E6%B5%8B%E8%B7%9D/" rel="tag">单目摄像头测距</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%88%E5%A4%AB%E6%9B%BC/" rel="tag">哈夫曼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" rel="tag">哈希表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag">图像处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D/" rel="tag">域名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A0%86/" rel="tag">堆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" rel="tag">多屏协同</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%AA%E7%94%9F%E7%BD%91%E7%BB%9C/" rel="tag">孪生网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/" rel="tag">局域网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" rel="tag">数据集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BF%80%E5%85%89%E6%B5%8B%E8%B7%9D/" rel="tag">激光测距</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%82%B9%E9%80%89%E9%AA%8C%E8%AF%81%E7%A0%81/" rel="tag">点选验证码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" rel="tag">端口转发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E5%B7%A5/" rel="tag">网工</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%81%E6%AF%9B%E5%AD%90%E5%9B%BA%E4%BB%B6/" rel="tag">老毛子固件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/" rel="tag">视频下载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" rel="tag">视频流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97/" rel="tag">语音转文字</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E5%83%8F%E7%B4%A0/" rel="tag">超像素</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E5%A3%B0%E6%B3%A2/" rel="tag">超声波</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BA/" rel="tag">路由器刷机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" rel="tag">软件安装配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">链表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9F%B3%E7%94%BB%E5%90%8C%E6%AD%A5/" rel="tag">音画同步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/" rel="tag">验证码</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/DDNS/" style="font-size: 10px;">DDNS</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/HTTP/" style="font-size: 10.67px;">HTTP</a> <a href="/tags/IP/" style="font-size: 10.67px;">IP</a> <a href="/tags/IPsec/" style="font-size: 10px;">IPsec</a> <a href="/tags/LDA/" style="font-size: 10px;">LDA</a> <a href="/tags/NFC/" style="font-size: 10px;">NFC</a> <a href="/tags/PDF/" style="font-size: 10px;">PDF</a> <a href="/tags/SMTP/" style="font-size: 10px;">SMTP</a> <a href="/tags/blog/" style="font-size: 11.33px;">blog</a> <a href="/tags/c/" style="font-size: 16px;">c++</a> <a href="/tags/chatgpt/" style="font-size: 10.67px;">chatgpt</a> <a href="/tags/cloudflare/" style="font-size: 11.33px;">cloudflare</a> <a href="/tags/docker/" style="font-size: 12.67px;">docker</a> <a href="/tags/flask/" style="font-size: 11.33px;">flask</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/js/" style="font-size: 11.33px;">js</a> <a href="/tags/linux/" style="font-size: 19.33px;">linux</a> <a href="/tags/nginx/" style="font-size: 12.67px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/ocr/" style="font-size: 10px;">ocr</a> <a href="/tags/php/" style="font-size: 10.67px;">php</a> <a href="/tags/pyinstaller/" style="font-size: 10px;">pyinstaller</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pytorch/" style="font-size: 16.67px;">pytorch</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rpa/" style="font-size: 10px;">rpa</a> <a href="/tags/selenium/" style="font-size: 11.33px;">selenium</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/ssh/" style="font-size: 13.33px;">ssh</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wol/" style="font-size: 10px;">wol</a> <a href="/tags/wordpress/" style="font-size: 10.67px;">wordpress</a> <a href="/tags/worldcloud/" style="font-size: 10px;">worldcloud</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 12.67px;">二叉树</a> <a href="/tags/%E4%BA%91%E7%9B%98/" style="font-size: 10px;">云盘</a> <a href="/tags/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B/" style="font-size: 10px;">人脸检测</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 13.33px;">代理</a> <a href="/tags/%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE/" style="font-size: 10px;">倍速播放</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 11.33px;">内网穿透</a> <a href="/tags/%E5%8D%95%E7%9B%AE%E6%91%84%E5%83%8F%E5%A4%B4%E6%B5%8B%E8%B7%9D/" style="font-size: 10px;">单目摄像头测距</a> <a href="/tags/%E5%93%88%E5%A4%AB%E6%9B%BC/" style="font-size: 10px;">哈夫曼</a> <a href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" style="font-size: 10.67px;">哈希表</a> <a href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 14px;">图像处理</a> <a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 10px;">域名</a> <a href="/tags/%E5%A0%86/" style="font-size: 10px;">堆</a> <a href="/tags/%E5%A4%9A%E5%B1%8F%E5%8D%8F%E5%90%8C/" style="font-size: 10px;">多屏协同</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E5%AD%AA%E7%94%9F%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">孪生网络</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 13.33px;">安卓</a> <a href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/" style="font-size: 12px;">局域网</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 18.67px;">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" style="font-size: 15.33px;">数据集</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size: 10px;">数组</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 14.67px;">树莓派</a> <a href="/tags/%E6%BF%80%E5%85%89%E6%B5%8B%E8%B7%9D/" style="font-size: 10px;">激光测距</a> <a href="/tags/%E7%82%B9%E9%80%89%E9%AA%8C%E8%AF%81%E7%A0%81/" style="font-size: 10px;">点选验证码</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 13.33px;">爬虫</a> <a href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" style="font-size: 18px;">目标检测</a> <a href="/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" style="font-size: 10px;">端口转发</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 11.33px;">编译原理</a> <a href="/tags/%E7%BD%91%E5%B7%A5/" style="font-size: 14px;">网工</a> <a href="/tags/%E8%80%81%E6%AF%9B%E5%AD%90%E5%9B%BA%E4%BB%B6/" style="font-size: 10px;">老毛子固件</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 10px;">虚拟机</a> <a href="/tags/%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/" style="font-size: 10.67px;">视频下载</a> <a href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" style="font-size: 10px;">视频流</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10.67px;">计算机网络</a> <a href="/tags/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E6%96%87%E5%AD%97/" style="font-size: 10px;">语音转文字</a> <a href="/tags/%E8%B6%85%E5%83%8F%E7%B4%A0/" style="font-size: 10px;">超像素</a> <a href="/tags/%E8%B6%85%E5%A3%B0%E6%B3%A2/" style="font-size: 10px;">超声波</a> <a href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BA/" style="font-size: 10px;">路由器刷机</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" style="font-size: 17.33px;">软件安装配置</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 10.67px;">递归</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 11.33px;">链表</a> <a href="/tags/%E9%9F%B3%E7%94%BB%E5%90%8C%E6%AD%A5/" style="font-size: 10px;">音画同步</a> <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/" style="font-size: 12.67px;">验证码</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/04/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2025/04/25/ubuntu24%E9%87%8D%E8%A3%85%E8%AE%B0%E5%BD%95/">ubuntu24重装记录</a>
          </li>
        
          <li>
            <a href="/2025/04/01/win11%E6%B7%BB%E5%8A%A0%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E7%BD%91%E5%8D%A1%E5%BC%82%E5%B8%B8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF/">win11添加开机自启动脚本实现网卡异常自动重启</a>
          </li>
        
          <li>
            <a href="/2025/02/06/DBeaver%E8%BF%9E%E6%8E%A5MySQL%E5%92%8CIoTDB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AD%A5%E9%AA%A4/">DBeaver连接MySQL和IoTDB数据库步骤</a>
          </li>
        
          <li>
            <a href="/2025/01/26/%E4%BD%BF%E7%94%A8polkit%E5%AE%9E%E7%8E%B0%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86systemctl%E6%9C%8D%E5%8A%A1/">使用polkit实现普通用户管理systemctl服务</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>